***************** CRAPS *****************************jrg 06okt88nach Wil Baden                                                                                                                  Da es in Deutschland das WÅrfelspiel CRAPS nicht gibt, habe ich diesem Begriff ein WÅrfel- und Trinkspiel aus der Schulzeit     unterlegt.                                                      Bei diesem Spiel steht in der Tischmitte ein Vorrat an gefÅlltenGlÑsern. Danach soll ein Mitspieler abhÑngig von seinem Wurf                                                                    entweder   ein neues Glas aus der Tischmitte vor sich stellen   oder       eines seiner GlÑser seinem Nachbarn zur linken oder             zur rechten zuschieben                               oder       alle vor ihm stehenden GlÑser austrinken.                                                                            Zuordnung: 1=nehmen, 2/3=links, 4/5=rechts, 6 trinken                                                                           \ nehmen  trinken  links  rechts  schieben           jrg 03feb89                                                                : nehmen   bright ." ein Glas nehmen"        normal  2 spaces ; : trinken  bright ." alle GlÑser austrinken" normal  2 spaces ; : links    bright ." ein Glas nach LINKS"    normal  2 spaces ; : rechts   bright ." ein Glas nach RECHTS"   normal  2 spaces ;                                                                 : schieben  ;                                                                                                                                                                                   : Anfrage      ." Sollen Sie nehmen, trinken oder schieben? "                  cr ." Bitte Ihre Augenzahl und <cr> : "   ;                                                                      : GlÅckwunsch  cr ." Viel GlÅck beim nÑchsten Wurf ... " ;                                                                      cr .( SprÅche geladen )                                         \ Auswertung mit IF...THEN / ENDIF                   jrg 03feb89                                                                ' THEN Alias ENDIF  immediate restrict                                                                                          : Auswertung  ( 1<= Wurfergebnis <=6  -- )                                                                                           dup 1 = IF nehmen          ENDIF                                dup 2 = IF links  schieben ENDIF                                dup 3 = IF links  schieben ENDIF                                dup 4 = IF rechts schieben ENDIF                                dup 5 = IF rechts schieben ENDIF                                dup 6 = IF trinken         ENDIF                                                                                                1 6 between not  IF invers ." Betrug!" normal ENDIF        ;                                                                                                                               \ =or                                                jrg 06okt88                                                                  code =or       ( n1 f1 n2 -- n1 f2 )                               A D xchg  D pop                                                 S W mov                                                           W ) A cmp                                                       0= ?[ -1 # D mov ]?                                          next                                                          end-code                                                                                                                      \ : =or  ( n1 f1 n2 -- n1 f2 )  2 pick = or ;                                                                                                                                                                                                                                                                                                                                                   \  Auswertung mit IF...THEN  und =or                 jrg 06okt88                                                                : Auswertung  ( 1<= Wurfergebnis <=6  -- )                           dup                                                             1 6 between IF                                                               dup 1 =       IF  nehmen   ENDIF                                dup 6 =       IF  trinken  ENDIF                                dup 2 = 3 =or IF  links    ENDIF                                dup 4 = 5 =or IF  rechts   ENDIF                               ELSE                                                             invers ." Betrugsversuch" normal                               ENDIF                                               drop                                                       ;                                                                                                                                                                                               \ CASE   OF  ENDOF   END-CASE     BREAK              jrg 30mai89                                                                 : CASE      ( n -- n n )  dup ;  restrict                                                                                       : OF        [compile] IF compile drop ;  immediate restrict                                                                     : ENDOF     [compile] ELSE 4+ ;  immediate restrict                                                                             : ENDCASE   compile drop                                                    BEGIN                                                             3 case?                                                       WHILE                                                             >resolve                                                      REPEAT ;  immediate restrict                                                                                        : BREAK     compile exit  [compile] THEN ;  immediate restrict \  Auswerten mit CASE OF ENDOF ENDCASE              jjrg 05feb89                                                                : Auswertung  ( 1<= n <=6  -- )                                                                                                     dup  1 6 between  not IF ." Betrug" drop exit ENDIF                                                                             CASE 1 =  OF nehmen  ENDOF                                      CASE 6 =  OF trinken ENDOF                                      CASE 4 <  OF links   ENDOF                                      CASE 3 >  OF rechts  ENDOF                                      ENDCASE                                                     ;                                                                                                                                                                                                                                                               \ Man beachte die Stellung der PlausibilitÑtsprÅfung            \  Auswerten mit =or und BREAK                       jrg 05feb89                                                                : Auswertung  ( 1<= n <=6  -- )                                                                                                     CASE 1 =        OF  nehmen    BREAK                             CASE 2 = 3 =or  OF  links     BREAK                             CASE 4 = 5 =or  OF  rechts    BREAK                             CASE 6 =        OF  trinken   BREAK                             ENDCASE                                                                                                                       invers ." Betrugsversuch" normal                              ;                                                                                                                                                                                                                                                                                                                               \ Das CRAPS Programm wie in PASCAL etc.              jrg 07okt88                                                                : CRAPS                                                                                                                             cr  Anfrage cr                                                                                                                        input#                                                          Auswertung                                                                                                                cr  GlÅckwunsch                                             ;                                                                                                                                                                                                                                                                                                                                                                                               \ ------------- VECTOR EXECUTION --------------------jrg 07okt88                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \  4TH braucht Prozeduren                            jrg 05feb89                                                                                                                                : bewegen  ( adr n -- cfa )                                         2* +  perform ;                                                                                                             : richtig  ( n  --  0<= n <= 3 )                                    swap                                                            1 max  6 min                        \ ein bi·chen Sicherheit    3 case? IF  2  1- exit  ENDIF                                   5 case? IF  4  1- exit  ENDIF                                   1-  ;                               \ ein bi·chen Justage                                                                                                                                                                                                                                                                   \  Die mîglichen Bewegungen mit  ] [  oder Create:   jrg 05feb89                                                                Create  Glas                                                            ]  nehmen  links schieben                                                  rechts schieben  trinken  [                                                                                                                                                  \ oder:                                                                                                                         Create: Glas                                                             nehmen                                                          links schieben                                                  rechts schieben                                                 trinken ;                                                                                                                                                                              \  Create: ; :Does>                                  jrg 05feb89                                                                Create: Auswertung                                                        nehmen                                                           links schieben                                                  rechts schieben                                                trinken ;                                                   :Does>                                                             richtig bewegen ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      \  Das vollstÑndige Programm                         jrg 05feb89                                                                : CRAPS                                                              cr  Anfrage cr                                                        input#                                                          Glas richtig bewegen                                      cr  GlÅckwunsch                                            ;                                                                                                                               \ ausschlie·lich als Datenstruktur                              : CRAPS                                                              cr  Anfrage cr                                                        input#                                                          Auswertung                                                cr  GlÅckwunsch                                            ;                                                               \ #### positional CASE def.words  Case: Associative: jrg 01feb89: Case:     ( -- )                                                 Create:                                                         Does>    ( pfa -- )  swap 2* +  perform ;                                                                                    : Associative:           ( n -- )                                  Constant   Does>      ( n - index )                             dup @ -rot                                                      dup @ 0                                                         DO  2+  2dup  @ =                                                   IF  2drop drop  I  0 0  LEAVE  THEN                         LOOP 2drop ;                                                                                                                 \ alternative Definition fÅr CASE:                                : Case:                                                             :  Does>   ( pfa -- )  swap 2* +  perform ;               \  CASE: in der Anwendung                            jrg 01feb89                                                                         Case:  bewegen                   \ besteht aus :                          nehmen                                                           links  links                                                    rechts rechts                                                  trinken ;                                                                                                                                                                    6 Associative:  auswerten                                                                                                                         1 ,                                                           2 , 3 ,                                                         4 , 5 ,                                                           6 ,                                                                                                           \  CASE:  und  Associative:                          jrg 01feb89                                                                : CRAPS   ( -- )                                                                                                                     cr  Anfrage cr                                                      input#                                                             auswerten                                                       bewegen                                                  cr  GlÅckwunsch                                            ;                                                                                                                                                                                                                                                                                                                                                                                                                                                               ************* Beginn der Kommentare *****************jrg 07okt88                                                                                                                                                                                                                                                                                                                                                                                                SCHIEBEN   gefÑllt mir deshalb so gut, weil es vorher nur als              FÅllsel arbeitet, aber hinterher als Dummy in der               Tabelle die wichtige Funktion hat, sechs mîgliche               WÅrfe sauber abzuarbeiten.                                                                                                                                                                                                                                                                                                                                                           \\ Auswertung mit IF...THEN / ENDIF                  jrg 01feb89                                                                ENDIF  macht deutlich(er), warum FORTH ohne Verbundanweisung wie       z.B. PASCAL auskommt.                                    AUSWERTUNG fÅhrt entsprechend einem Selektor genau eine von 6          mîglichen Prozeduren aus.                                                                                                Auch eine mîgliche Form der Auswertung mit CASE? :              : Auswertung  ( 1<= Wurfergebnis <=6  -- )                            1 case? IF nehmen           exit ENDIF                          2 case? IF links  schieben  exit ENDIF                          3 case? IF links  schieben  exit ENDIF                          4 case? IF rechts schieben  exit ENDIF                          5 case? IF rechts schieben  exit ENDIF                          6 case? IF trinken          exit ENDIF                      1 6 between not  IF invers ." Betrugsversuch" normal ENDIF ;  \\ hilfreiche Prozeduren fÅr das kommende CASE                                                                                  =OR     prÅft eine Zahl n2 auf Gleichheit mit einem Testwert n1         und verknÅpft resultierende Ergebnis mit einem bereits          vorliegenden flag f1. Es werden das neue flag f2 und der        "alte" Testwert n1 Åbergeben.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \\ bedingte Verzweigung mit IF .. ELSE .. ENDIF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \\ Die Definitionen fÅr die CASE Anweisung           jrg 07okt88                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                BREAK   ist ein EXIT aus der CASE-Anweisung; return to caller   \\ Auswertung mit CASE OF ENDOF                                                                                                                                                                                                                                 Sicherheit gegen falsche Zahlen                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \\ Die elegantere Auswertung mit BREAK               jrg 07okt88                                                                BREAK  = Verlassen des Callee                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Wird trotz BREAK dieser Prozedurteil erreicht, mu· die Zahl un- gÅltig gewesen sein.                                                                                                                                                                                                                                                                                                                                                                 jrg 07okt88                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \ Ui jui jui / Test fÅr ein CRAPS                                                                                                 : Test                                                              full page                                                       20 0 DO                                                               craps                                                          LOOP ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \\ FÅr Datenobjekte sind Prozeduren notwendig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \\ Was sind denn die Datenobjekte ?                  jrg 07okt88                                                                GLAS    als Datenteil enthÑlt natÅrlich die in Frage kommenden          Prozeduren.                                                                                                                                                                                                                                                                                                             GLAS    ist der gleiche Datenteil wie oben, nur eleganter.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      \\ Zusammenfassen des Datenteils und des Zugriffsteiljrg 07okt88                                                                                                                                                                                                                                                                                                                                                                                                                                                                RICHTIG und BEWEGEN sind die eigens fÅr den Datenteil GLAS ent-         worfenen Zugriffsprozeduren. Deshalb bietet es sich an,         diese mit GLAS zusammenzufÅgen.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         