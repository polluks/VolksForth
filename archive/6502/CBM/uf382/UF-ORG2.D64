\\ ƒIRECTORY ULTRA∆œ“‘» 2OF4   26OCT87RE                                          .                    0                   ..                   0                   DIVERSES           $08                   √64/√16            $09                   ”YSTEM             $0∆                   √64INTERFACE       $7D                   √16INIT            $94                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \\ …NHALT ULTRA∆œ“‘» 2OF4      26OCT87RE                                          ƒIRECTORY            0                   …NHALT               1                   DIVERSES           $08                   √64 ODER √16       $09                   ”YSTEM             $0∆                   √64/√16INTERFACE   $7D                                      $95-A9 FREE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          \ RAM ROM JSR ŒORM SR F.√16+ CLV12.4.87)                                                                                   ¡SSEMBLER ALSO DEFINITIONS                                                        (C16+ \ √16+ÕAKROS FUER ¬ANKSWITCH.                                               : RAM $FF3F STA ;   : ROM $FF3E STA ;                                             '  SR ¡LIAS ŒORM SR   ƒEFER  SR                                                   : √16+ SR DUP $C000 U>                    …∆ ROM ŒORM SR RAM ≈Ã”≈ ŒORM SR ‘»≈Œ ;                                           ' √16+ SR …S  SR                         )                                                                                                                                                                                                                                                                                                                                                                                                                        \ ‘ARGET-ÕACHINE              CLV14OCT87                                          œNLYFORTH                                                                                                                  CR .( »OST IS: )                             (64  .( √64) √)                          (16  .( √16) √)                                                                      : )     ; IMMEDIATE                      : (√    ; IMMEDIATE                                                               : (√64  ; IMMEDIATE               \      : (√16  ; IMMEDIATE               \      : (√16+ ; IMMEDIATE               \      : (√16- ; IMMEDIATE                                                        \      : (√64  [COMPILE] ( ; IMMEDIATE          : (√16  [COMPILE] ( ; IMMEDIATE          : (√16+ [COMPILE] ( ; IMMEDIATE          : (√16- [COMPILE] ( ; IMMEDIATE                                                                                                                                                                      \  SR-ÕAKROS LADEN/LOESCHEN  CLV14.4.87)                                          ¡SSEMBLER ALSO DEFINITIONS                                                        (√16+ \NEEDS √16+ SR          -2 +LOAD ) (√16+ ' √16+ SR …S  SR .(  ”“ …S:√16+  ) (√16+ \\ IGNORIERT DEN “EST DES ”CREEN )                                          \ ALLE ANDERN BRAUCHEN KEINE ÕAKROS      \ ◊ENN ÕAKROS NICHT GELADEN,             \      DANN “EST IGNORIEREN:                                                      \NEEDS √16+ SR \\                                                                 \ ◊ENN ÕAKROS VORHANDEN: REDEFINIEREN:                                            ' ŒORM SR …S  SR .(  ”“ …S:ŒORM )                                                                                                                                                                                                                                                                                                                                               CR .( ‘ARGET IS: ) \         CLV14.4.87)                                                                                   (√    .( √¬Õ )                           (√64  .( √64 )                           (√16  .( √16 WITH )                      (√16+ .( 64KB )                          (√16- .( 32KB )                                                                   CR .( ‘ARGET IS NOT: )                                                            (√    \ )      .( √¬Õ, )                 (√64  \ )      .( √64, )                 (√16  \ )      .( √16, )                 (√16+ \ )      .( √16+64KB, )            (√16- \ )      .( √16-32KB, )                                                                                                                                                                                                                                                                                                                                                                                            \ RAMFILL                             3:                                          œNLYFORTH                                                                         √ODE RAMFILL   ( ADR N 8B -)              SEI  34 # LDA  1 STA                     3 # LDA SETUP JSR                        Œ 3 + LDX TXA  Œ 2+ ORA 0<>               ?[ Œ LDA 0 # LDY                           [[ 0 # CPX 0<>                             ?[[ [[ Œ 4 + )Ÿ STA INY 0= ?]                Œ 5 + INC DEX ]]?                 Œ 2+ LDX 0<> ?[                          [[ Œ 4 + )Ÿ STA INY Œ 2+ CPY √” ?] ]?   ]?                                      36 # LDA  1 STA CLI                      0 # LDX 1 # LDY ŒEXT JMP                END-CODE                                                                          $√000 $4000 (16 $300 - √)  0 RAMFILL                                              FORGET RAMFILL                                                                                                                                                     ( ƒELETING ¡SSEMBLER ÃABELS BP27JUN85WE)                                          : DELETE   ¡SSEMBLER NAME FIND            …∆  >NAME COUNT $1∆ AND                    BOUNDS ?ƒœ $1∆ … C! Ãœœ–               ≈Ã”≈  COUNT TYPE SPACE ‘»≈Œ ;                                                    DELETE SETUP     DELETE XYŒEXT           DELETE –UTA      DELETE ”–               DELETE –OP       DELETE ŒEXT             DELETE Œ         DELETE ’–               DELETE –OPTWO    DELETE ◊                DELETE …–        DELETE “–               DELETE –USH      DELETE –USH0¡           DELETE –USH¡     DELETE ;C:                                                       FORGET DELETE œNLYFORTH                                                                                                                                                                                                                                                                                                                                                         ( ƒEFINITION FUER .STATUS     28JUN85WE)                                          : STATUS                                  BLK @ ?DUP …∆                             ."  BLK " U.                             ." HERE "  HERE U.                       ." THERE " THERE U.                      ." HEAP "  HEAP U.  CR                   ‘»≈Œ ;                                                                          ' STATUS IS .STATUS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \ √64    ∆ORTH LOADSCREE      CLV14OCT87                                          œNLYFORTH HEX                              -3    +LOAD   \ CLEAR MEMORY AND         -2 -1 +THRU   \ CLR LABELS  .STATUS      -6 -4 +THRU   \ ‘ARGET-ÕACHINE         œNLYFORTH                                                                         (√64 $801 ) (√16 $1001 ) DUP DISPLACE !                                           ‘ARGET DEFINITIONS   HERE!                                                        $1 $6≈ +THRU                                                                      ¡SSEMBLER NONRELOCATE                                                             .UNRESOLVED                                                                       ' .BLK IS .STATUS                                                                     -4 +LOAD    \ –RINT ‘ARGET-ÕACHINE                                            CR .( SAVE-TARGET ULTRAFORTH83)          91 CON! ( √URSOR UP) QUIT                                                        \ ∆œ“‘» –REAMBLE AND …ƒ       CLV06AUG87                                          (√64  $ƒ C, $8 C, $¡ C, 00 C, 9≈ C,      28 C, 32 C, 30 C, 36 C, 34 C, 29 C,      00 C, 00 C, 00 C, 00 C, ) \ ”Ÿ”(2064)    (√16  $ƒ C, 10 C, $¡ C, 00 C, 9≈ C,      28 C, 34 C, 31 C, 31 C, 32 C, 29 C,      00 C, 00 C, 00 C, 00 C, ) \ ”Ÿ”(4112)                                             ¡SSEMBLER                                  NOP  0 JMP  HERE 2- >LABEL >COLD         NOP  0 JMP  HERE 2- >LABEL >RESTART                                             HERE DUP ORIGIN!                         \ »IER BEGINNEN DIE ÀALTSTARTWERTE DER   \ ¬ENUTZERVARIABLEN                      0 JMP  0 JSR  HERE 2- >LABEL >WAKE        END-CODE                                $100 ALLOT                                                                        ‹ √REATE LOGO                             (√64  ," ULTRA∆œ“‘»-83 3.80-√64  " )     (√16+ ," ULTRA∆œ“‘»-83 3.80-√16+ " )     (√16- ," ULTRA∆œ“‘»-83 3.80-√16- " )                                            ( ⁄ERO PAGE ÷ARIABLES & ŒEXT  03APR85BP)                                          02 DUP     >LABEL “–     2+                 DUP     >LABEL ’–     2+                                                          DUP     >LABEL –UTA   1+                 DUP     >LABEL ”–     2+                 DUP     >LABEL ŒEXT                      DUP 5 + >LABEL …–                           13 + >LABEL ◊                                                                    ◊ 8 + >LABEL Œ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( ŒEXT, MOVED INTO ⁄ERO PAGE  08APR85BP)                                          ÃABEL ¬OOTNEXT                              -1 STA              \ -1 IS DUMMY ”–     …– )Ÿ LDA  ◊ 1+  STA                     -1 LDA     ◊ STA    \ -1 IS DUMMY …–     CLC …– LDA  2 # ADC  …– STA                √” NOT ?[ ÃABEL ◊JMP -1 ) JMP ]?       …– 1+ INC  ◊JMP BCS                   END-CODE                                                                          HERE ¬OOTNEXT - >LABEL ¬OOTNEXTLEN                                                √ODE END-TRACE  ( –ATCH ŒEXT FOR TRACE )  $¡5 # LDA  ŒEXT $¡ + STA                  …– # LDA  ŒEXT $¬ + STA                 $69 # LDA  ŒEXT $√ + STA                   2 # LDA  ŒEXT $ƒ + STA                 ŒEXT JMP   END-CODE                                                                                                                                                                                                                                                                          \ ;C:  NOOP                    02NOV87RE                                          √REATE RECOVER  ( -- ADR )   ¡SSEMBLER    PLA  ◊ STA  PLA  ◊ 1+ STA                ◊ WDEC  0 JMP   END-CODE                                                         HERE 2- >LABEL >RECOVER                  \ HANDGESTRICKTE VORWAERTS “EFERENZ FUER \ DEN JMP-¬EFEHL                                                                  √OMPILER ¡SSEMBLER ALSO DEFINITIONS       » : ;C:   0 ‘ RECOVER JSR                END-CODE  ] » ;                         ‘ARGET                                                                            √ODE NOOP   ŒEXT HERE 2- !  END-CODE                                                                                                                                                                                                                                                                                                                                                                                     \ ’SER VARIABLES              CLV14OCT87                                          √ONSTANT ORIGIN  8 UALLOT DROP                            \ ∆OR MULTITASKER                                                ’SER S0       $7√∆¡ S0 !                 ’SER R0       $7∆∆≈ R0 !                 ’SER DP                                  ’SER OFFSET      0 OFFSET !              ’SER BASE      &10 BASE !                ’SER OUTPUT                              ’SER INPUT                               ’SER ERRORHANDLER                             \ POINTER FOR  ¡BORT" -CODE         ’SER VOC-LINK                            ’SER UDP                                      \ POINTS TO NEXT FREE ADDR IN ’SER                                                                                                                                                                                                                                                                                                                                         ( MANIPULATE SYSTEM POINTERS  29JAN85BP)                                          √ODE SP@   ( -- ADDR)                     ”– LDA  Œ STA  ”– 1+ LDA  Œ 1+ STA       Œ # LDX                                 ÃABEL ÿPUSH                               ”– 2DEC  1 ,ÿ LDA  ”– )Ÿ STA             0 ,ÿ LDA  0 # LDX  –UTA JMP   END-CODE                                           √ODE SP!   ( ADDR --)                     ”– ÿ) LDA  TAX  ”– )Ÿ LDA                ”– 1+ STA  ”– STX   0 # LDX              ŒEXT JMP   END-CODE                                                              √ODE UP@   ( -- ADDR)                     ’– # LDX  ÿPUSH JMP  END-CODE                                                    √ODE UP!   ( ADDR --)      ’– # LDX      ÃABEL ÿPULL     ”– )Ÿ LDA  1 ,ÿ STA                  DEY ”– )Ÿ LDA  0 ,ÿ STA      ÃABEL (XYDROP   0 # LDX  1 # LDY         ÃABEL (DROP     ”– 2INC  ŒEXT JMP        END-CODE RESTRICT                                                                                                         ( MANIPULATE RETURNSTACK   16FEB85BP/KS)                                          √ODE RP@ ( -- ADDR )                      “– # LDX  ÿPUSH JMP  END-CODE                                                    √ODE RP! ( ADDR -- )                      “– # LDX  ÿPULL JMP  END-CODE RESTRICT                                           √ODE >R  ( 16B --  )                      “– 2DEC  ”– ÿ) LDA   “– ÿ) STA           ”– )Ÿ LDA   “– )Ÿ STA (DROP JMP         END-CODE RESTRICT                                                                 √ODE R>  ( -- 16B)                        ”– 2DEC  “– ÿ) LDA  ”– ÿ) STA                     “– )Ÿ LDA  ”– )Ÿ STA           ÃABEL (RDROP     2 # LDA                 ÃABEL (NRDROP    CLC  “– ADC  “– STA         √” ?[  “– 1+ INC  ]?                  ŒEXT JMP  END-CODE  RESTRICT                                                                                                                                                                                                                        \ R@ RDROP  EXIT  ?EXIT       CLV12JUL87                                          √ODE R@      ( -- 16B)                    ”– 2DEC  “– )Ÿ LDA  ”– )Ÿ STA                     “– ÿ) LDA  –UTA JMP            END-CODE                                                                          √ODE RDROP    (RDROP HERE 2- !           END-CODE   RESTRICT                                                               √ODE EXIT                                 “– ÿ) LDA  …– STA                        “– )Ÿ LDA  …– 1+ STA                     (RDROP JMP   END-CODE                   √ODE UNNEST                               “– ÿ) LDA  …– STA                        “– )Ÿ LDA  …– 1+ STA                     (RDROP JMP   END-CODE                                                            √ODE ?EXIT     ( FLAG -- )                ”– ÿ) LDA  ”– )Ÿ ORA                     PHP  ”– 2INC  PLP                        ' EXIT @ BNE  ŒEXT JMP                  END-CODE                                                                         ( EXECUTE  PERFORM            08APR85BP)                                          √ODE EXECUTE  ( ADDR --)                  ”– ÿ) LDA   ◊ STA                        ”– )Ÿ LDA   ◊ 1+ STA                     ”– 2INC     ◊ 1- JMP   END-CODE                                                  : PERFORM ( ADDR -- )   @ EXECUTE ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( C@   C! CTOGGLE             10JAN85BP)                                          √ODE C@ ( ADDR -- 8B)                     ”– ÿ) LDA  Œ STA   ”– )Ÿ LDA  Œ 1+ STA  ÃABEL (C@    0 # LDA  ”– )Ÿ STA           Œ ÿ)  LDA   –UTA JMP   END-CODE                                                  √ODE C!  ( 16B ADDR --)                   ”– ÿ) LDA   Œ STA   ”– )Ÿ LDA  Œ 1+ STA  INY  ”– )Ÿ LDA  Œ ÿ) STA DEY            ÃABEL (2DROP                              ”– LDA  CLC  4 # ADC  ”– STA               √” ?[  ”– 1+ INC  ]?                   ŒEXT JMP   END-CODE                                                              : CTOGGLE   ( 8B ADDR --)                 UNDER C@ XOR SWAP C! ;                                                                                                                                                                                                                                                                                                                                                         ( @ ! +!                      08APR85BP)                                          √ODE @  ( ADDR -- 16B)                    ”– ÿ) LDA  Œ STA  ”– )Ÿ LDA  Œ 1+ STA    Œ )Ÿ LDA  ”– )Ÿ STA                      Œ ÿ) LDA –UTA JMP   END-CODE                                                     √ODE !   ( 16B ADDR --)                   ”– ÿ) LDA  Œ STA  ”– )Ÿ LDA  Œ 1+ STA    INY ”– )Ÿ LDA  Œ ÿ) STA                  INY ”– )Ÿ LDA   1 # LDY                 ÃABEL (!                                  Œ )Ÿ STA  (2DROP JMP   END-CODE                                                  √ODE +!  ( N ADDR --)                     ”– ÿ) LDA  Œ STA  ”– )Ÿ LDA  Œ 1+ STA    INY  ”– )Ÿ LDA  CLC  Œ ÿ) ADC Œ ÿ) STA   INY  ”– )Ÿ LDA  1 # LDY  Œ )Ÿ ADC        (! JMP   END-CODE                                                                                                                                                                                                                                                                            ( DROP SWAP                   24MAY84KS)                                          √ODE DROP  ( 16B --)                      (DROP HERE 2- !  END-CODE                                                        √ODE SWAP  ( 16B1 16B2 -- 16B2 16B1 )     ”– )Ÿ LDA  TAX                           3 # LDY  ”– )Ÿ LDA  Œ STA                TXA  ”– )Ÿ STA                           Œ LDA  1 # LDY  ”– )Ÿ STA                INY  0 # LDX                             ”– )Ÿ LDA  Œ STA  ”– ÿ) LDA  ”– )Ÿ STA   DEY                                      Œ LDA –UTA JMP   END-CODE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( DUP  ?DUP                   08MAY85BP)                                          √ODE DUP   ( 16B -- 16B 16B)              ”– 2DEC                                  3 # LDY  ”– )Ÿ LDA  1 # LDY  ”– )Ÿ STA   INY  ”– )Ÿ LDA  DEY                      –UTA JMP   END-CODE                                                              √ODE ?DUP     ( 16B -- 16B 16B / FALSE)   ”– ÿ) LDA  ”– )Ÿ ORA                       0= ?[  ŒEXT JMP  ]?                    ' DUP @ JMP END-CODE                                                                                                      \\ : ?DUP   ( 16B -- 16B 16B / FALSE)        DUP  …∆  DUP  ‘»≈Œ ;                                                             : DUP    ”P@  @  ;                                                                                                                                                                                                                                                                                                                  ( OVER ROT                    13JUN84KS)                                          √ODE OVER  ( 16B1 16B2 - 16B1 16B3 16B1)                                           ”– 2DEC  4 # LDY  ”– )Ÿ LDA  ”– ÿ) STA   INY  ”– )Ÿ LDA  1 # LDY  ”– )Ÿ STA       ŒEXT JMP   END-CODE                                                              √ODE ROT                                     ( 16B1 16B2 16B3 -- 16B2 16B3 16B1)   3 # LDY  ”– )Ÿ LDA  Œ 1+ STA             1 # LDY  ”– )Ÿ LDA  3 # LDY  ”– )Ÿ STA   5 # LDY  ”– )Ÿ LDA  Œ STA                Œ 1+ LDA  ”– )Ÿ STA                      1 # LDY  Œ LDA  ”– )Ÿ STA                INY  ”– )Ÿ LDA  Œ 1+ STA                 ”– ÿ) LDA  ”– )Ÿ STA                     4 # LDY  ”– )Ÿ LDA  ”– ÿ) STA            Œ 1+ LDA  ”– )Ÿ STA                      1 # LDY  ŒEXT JMP   END-CODE                                                     \\ : ROT   >R SWAP R> SWAP ;                : OVER  >R DUP R> SWAP ;                                                                                               ( -ROT NIP UNDER PICK ROLL    24DEC83KS)                                          : -ROT                                       ( 16B1 16B2 16B3 -- 16B3 16B1 16B2)   ROT ROT ;                                                                        : NIP   ( 16B1 16B2 -- 16B2)              SWAP DROP ;                                                                      : UNDER ( 16B1 16B2 -- 16B2 16B1 16B2)    SWAP OVER ;                                                                      : PICK  ( N -- 16B.N )   1+ 2* SP@ + @ ;                                          : ROLL  ( N --)                           DUP >R PICK SP@ DUP 2+ R> 1+ 2* CMOVE>   DROP ;                                                                           \\ : -ROLL ( N --)                        >R DUP SP@  DUP 2+ DUP 2+ SWAP           R@ 2* CMOVE R> 1+ 2* + ! ;                                                                                                                                                                                 ( DOUBLE WORD STACK MANIP.    21APR83KS)                                          : 2SWAP ( 32B1 32B2 -- 32B2 32B1)         ROT >R ROT R> ;                                                                  √ODE 2DROP ( 32B -- )                     (2DROP HERE 2- !   END-CODE                                                      \  : 2DROP ( 32B -- )    DROP DROP ;                                              : 2DUP  ( 32B -- 32B 32B)                 OVER OVER ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( + AND OR XOR                08APR85BP)                                          √OMPILER  ¡SSEMBLER ALSO DEFINITIONS                                              » : ƒYADOP ( OPCODE --)  ‘                  INY  ”– ÿ) LDA  DUP C, ”– C,             ”– )Ÿ STA                                DEY  ”– )Ÿ LDA  3 # LDY  C, ”– C,        ”– )Ÿ STA                                (XYDROP JMP  » ;                                                               ‘ARGET                                                                            √ODE +     ( N1 N2 -- N3)                 CLC $71 ƒYADOP   END-CODE                                                        √ODE OR    ( 16B1 16B2 -- 16B3)               $11 ƒYADOP   END-CODE                                                        √ODE AND   ( 16B1 16B2 -- 16B3)               $31 ƒYADOP   END-CODE                                                        √ODE XOR   ( 16B1 16B2 -- 16B3)               $51 ƒYADOP   END-CODE                                                       ( -  NOT  NEGATE              24DEC83KS)                                          √ODE -    ( N1 N2 -- N3)                  INY ”– )Ÿ LDA  SEC ”– ÿ) SBC ”– )Ÿ STA   INY ”– )Ÿ LDA                            1 # LDY  ”– )Ÿ SBC  3 # LDY  ”– )Ÿ STA   (XYDROP JMP   END-CODE                                                           √ODE NOT   ( 16B1 -- 16B2)   CLC         ÃABEL (NOT                                TXA  ”– ÿ) SBC  ”– ÿ) STA  TXA                ”– )Ÿ SBC  ”– )Ÿ STA                ŒEXT JMP   END-CODE                                                              √ODE NEGATE   ( N1 -- N2 )                SEC  (NOT BCS   END-CODE                                                         \ : -       NEGATE + ;                                                                                                                                                                                                                                                                                                                 ( DNEGATE SETUP D+            14JUN84KS)                                          √ODE DNEGATE ( D1 -- -D1)                 INY  SEC                                 TXA  ”– )Ÿ SBC  ”– )Ÿ STA  INY           TXA  ”– )Ÿ SBC  ”– )Ÿ STA                TXA  ”– ÿ) SBC  ”– ÿ) STA  1 # LDY       TXA  ”– )Ÿ SBC  ”– )Ÿ STA                ŒEXT JMP  END-CODE                                                               ÃABEL ”ETUP  ( QUAN  IN ¡)                .¡ ASL TAX TAY  DEY                         [[ ”– )Ÿ LDA  Œ ,Ÿ STA  DEY  0< ?]    TXA  CLC  ”– ADC  ”– STA                    √” ?[  ”– 1+ INC  ]?                  0 # LDX  1 # LDY   RTS   END-CODE                                                √ODE D+      ( D1 D2 -- D3)               2 # LDA  ”ETUP JSR  INY                  ”– )Ÿ LDA  CLC Œ 2+  ADC ”– )Ÿ STA INY   ”– )Ÿ LDA      Œ 3 + ADC ”– )Ÿ STA       ”– ÿ) LDA  Œ    ADC ”– ÿ) STA  1 # LDY   ”– )Ÿ LDA  Œ 1+ ADC ”– )Ÿ STA            ŒEXT JMP   END-CODE                                                             ( 1+ 2+ 3+    1- 2-           08APR85BP)                                          √ODE 1+   ( N1 -- N2)   1 # LDA          ÃABEL N+  CLC  ”– ÿ) ADC                  √” NOT   ?[  –UTA JMP  ]?                ”– ÿ) STA  ”– )Ÿ LDA  0 # ADC ”– )Ÿ STA  ŒEXT JMP  END-CODE                                                               √ODE 2+   ( N1 -- N2)                     2 # LDA   N+ BNE     END-CODE           √ODE 3+   ( N1 -- N2)                     3 # LDA   N+ BNE     END-CODE           ‹ √ODE 4+ ( N1 -- N2)                     4 # LDA   N+ BNE     END-CODE           ‹ √ODE 6+ ( N1 -- N2)                     6 # LDA   N+ BNE     END-CODE                                                    √ODE 1-   ( N1 -- N2)   SEC              ÃABEL (1-     ”– ÿ) LDA  1 # SBC            √” ?[ –UTA JMP ]?                      ”– ÿ) STA  ”– )Ÿ LDA  0 # SBC ”– )Ÿ STA  ŒEXT JMP  END-CODE                                                               √ODE 2-   ( N1 -- N2)                     CLC (1- BCC  END-CODE                  ( NUMBER √ONSTANTS            24DEC83KS)                                          -1 √ONSTANT TRUE    0 √ONSTANT FALSE                                              ' TRUE ¡LIAS -1     ' FALSE ¡LIAS 0                                               1 √ONSTANT 1        2 √ONSTANT 2         3 √ONSTANT 3        4 √ONSTANT 4                                                  : ON    ( ADDR -- )  TRUE  SWAP ! ;      : OFF   ( ADDR -- )  FALSE SWAP ! ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ( WORDS FOR NUMBER LITERALS   24MAY84KS)                                          √ODE CLIT  ( -- 8B)                       ”– 2DEC  …– ÿ) LDA  ”– ÿ) STA             TXA   ”– )Ÿ STA  …– WINC                ŒEXT JMP   END-CODE RESTRICT                                                     √ODE LIT   ( -- 16B)                      ”– 2DEC  …– )Ÿ LDA  ”– )Ÿ STA                     …– ÿ) LDA  ”– ÿ) STA           ÃABEL (BUMP   …– 2INC                     ŒEXT JMP  END-CODE RESTRICT                                                      : ÃITERAL   ( 16B --)                     DUP $∆∆00 AND                              …∆  COMPILE LIT   , EXIT ‘»≈Œ                COMPILE CLIT C,  ;                IMMEDIATE RESTRICT                                                                                                         \\ : LIT     R> DUP 2+ >R  @  ;             : CLIT    R> DUP 1+ >R  C@ ;                                                                                                                                    ( COMPARISION CODE WORDS      13JUN84KS)                                          √ODE 0<   ( N -- FLAG)                    ”– )Ÿ LDA  0< ?[                        ÃABEL PUT‘RUE    $∆∆ # LDA  $24 C, ]?    ÃABEL PUT∆ALSE   TXA  ”– )Ÿ STA           –UTA JMP   END-CODE                                                              √ODE 0=   ( 16B -- FLAG)                  ”– ÿ) LDA  ”– )Ÿ ORA                     PUT‘RUE  BEQ                             PUT∆ALSE BNE  END-CODE                                                           √ODE UWITHIN  ( U1 [LOW UP[  -- FLAG)     2 # LDA  ”ETUP JSR                       1 # LDY  ”– ÿ) LDA  Œ CMP                         ”– )Ÿ LDA  Œ 1+ SBC              √” NOT ?[ ( Œ>”–) ”– ÿ) LDA Œ 2+  CMP                      ”– )Ÿ LDA Œ 3 + SBC             PUT‘RUE BCS ]?                 PUT∆ALSE JMP  END-CODE                                                                                                                                                                                     ( COMPARISION CODE WORDS      13JUN84KS)                                          √ODE <    ( N1 N2 -- FLAG)                ”– ÿ) LDA  Œ STA  ”– )Ÿ LDA  Œ 1+ STA    ”– 2INC                                  Œ 1+ LDA  ”– )Ÿ EOR  ' 0< @  BMI         ”– ÿ) LDA  Œ CMP  ”– )Ÿ LDA  Œ 1+ SBC    ' 0< @ 2+ JMP    END-CODE                                                        √ODE U<   ( U1 U2 -- FLAG)                ”– ÿ) LDA  Œ STA  ”– )Ÿ LDA  Œ 1+ STA    ”– 2INC                                  ”– ÿ) LDA  Œ CMP  ”– )Ÿ LDA  Œ 1+ SBC      √” NOT ?[  PUT‘RUE JMP  ]?                          PUT∆ALSE JMP  END-CODE                                                                                                                                                                                                                                                                                                                                                                                                                              ( COMPARISION WORDS           24DEC83KS)                                          \ : 0<   $8000 AND  0<> ;                                                         : >   ( N1 N2 -- FLAG)  SWAP < ;                                                  : 0>  ( N --     FLAG)  NEGATE 0<  ;                                              : 0<> ( N --     FLAG)  0= NOT ;                                                  : U>  ( U1 U2 -- FLAG)  SWAP U< ;                                                 : =   ( N1 N2 -- FLAG)  - 0= ;                                                    : D0= ( D --     FLAG)  OR 0= ;                                                   : D=  ( D1 D2 -- FLAG)  DNEGATE D+ D0= ;                                          : D<  ( D1 D2 -- FLAG)  ROT 2DUP -        …∆ > NIP NIP  ≈Ã”≈ 2DROP U< ‘»≈Œ ;                                                                                                                                                                                                                  ( MIN MAX UMAX UMIN EXTEND DABS ABS  KS)                                          ‹ : MINIMAX  ( N1 N2 FLAG -- N3)            RDROP  …∆ SWAP ‘»≈Œ DROP ;                                                     : MIN   ( N1 N2 -- N3)                    2DUP  > MINIMAX ;                                                                : MAX   ( N1 N2 -- N3)                    2DUP  < MINIMAX ;                                                                : UMAX  ( U1 U2 -- U3)                    2DUP U< MINIMAX ;                                                                : UMIN  ( U1 U2 -- U3)                    2DUP U> MINIMAX ;                                                                                                         : EXTEND  ( N -- D)     DUP 0< ;                                                  : DABS    ( D -- UD)                      EXTEND …∆  DNEGATE ‘»≈Œ ;                                                        : ABS     ( N -- U)                       EXTEND …∆   NEGATE ‘»≈Œ ;              \ LOOP PRIMITIVES              02NOV87RE                                          ‹ : DODO                                  RDROP R> 2+ DUP >R ROT >R SWAP >R >R ;                                           : (DO  ( LIMIT STAR -- )                  OVER - DODO ;      RESTRICT                                                      : (?DO ( LIMIT START -- )                 OVER - ?DUP  …∆ DODO ‘»≈Œ                R> DUP @ +  >R DROP ;       RESTRICT                                             : BOUNDS  ( START COUNT -- LIMIT START )  OVER + SWAP ;                                                                    √ODE ENDLOOP  ( -- )                      6 # LDA (NRDROP JMP   END-CODE RESTRICT                                          \\ DODO PUTS  "INDEX ‹ LIMIT ‹            ADR.OF.ƒœ"  ON RETURN-STACK                                                                                                                                                                                                                         \ (LOOP (+LOOP                 02NOV87RE                                          √ODE (LOOP                                CLC  1 # LDA  “– ÿ) ADC “– ÿ) STA          √” ?[  “– )Ÿ LDA  0 # ADC “– )Ÿ STA         √” ?[ ŒEXT JMP ]? ]?               ÃABEL DOLOOP  5 # LDY                     “– )Ÿ LDA  …– 1+ STA  DEY                “– )Ÿ LDA  …–    STA  1 # LDY            ŒEXT JMP    END-CODE RESTRICT                                                    √ODE (+LOOP  ( N -- )                     CLC ”– ÿ) LDA  “– ÿ) ADC  “– ÿ) STA          ”– )Ÿ LDA  “– )Ÿ ADC  “– )Ÿ STA      .¡ ROR  ”– )Ÿ EOR                        PHP  ”– 2INC  PLP DOLOOP BPL             ŒEXT JMP    END-CODE RESTRICT                                                                                                                                                                                                                                                                                                                                                  ( LOOP INDICES                08APR85BP)                                          √ODE …  ( -- N)    0 # LDY               ÃABEL LOOPINDEX    ”– 2DEC   CLC          “– )Ÿ LDA  INY  INY                      “– )Ÿ ADC  ”– ÿ) STA  DEY                “– )Ÿ LDA  INY  INY                      “– )Ÿ ADC  1 # LDY  ”– )Ÿ STA            ŒEXT JMP   END-CODE RESTRICT                                                     √ODE    ( -- N)                           6 # LDY  LOOPINDEX BNE                              END-CODE  RESTRICT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      \ BRANCHING                    02NOV87RE                                          √ODE BRANCH                               CLC  …–    LDA  …– ÿ) ADC  Œ STA              …– 1+ LDA  …– )Ÿ ADC  …– 1+ STA     Œ LDA …– STA                             ŒEXT JMP     END-CODE RESTRICT                                                   √ODE ?BRANCH  ( FLAG -- )                 ”– ÿ) LDA  ”– )Ÿ ORA                     PHP  ”– 2INC  PLP                        ' BRANCH @ BEQ    (BUMP JMP             END-CODE   RESTRICT                                                                                                                                                 \\  : BRANCH   R> DUP @ + >R ; RESTRICT                                               : ?BRANCH  ( FLAG -- )                    0= R> OVER NOT OVER 2+  AND -ROT         DUP @ + AND OR >R ;       RESTRICT                                                                                                                                                                     ( RESOLVE LOOPS AND BRANCHES  03FEB85BP)                                          : >MARK     ( -- ADDR)  HERE   0 , ;                                              : >RESOLVE  ( ADDR --)                    HERE OVER -   SWAP !  ;                                                          : <MARK     ( -- ADDR)  HERE ;                                                    : <RESOLVE  ( ADDR --) HERE - ,  ;                                                : ?PAIRS  ( N1 N2 -- )                    -  ¡BORT" UNSTRUCTURED" ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( CASE?                       04MAY85BP)                                          ÃABEL  –USH¡                              0 # CMP  0< ?[ PHA  $∆∆ # LDA ][        ÃABEL  –USH0¡   PHA   0  # LDA  ]?       ÃABEL  –USH     TAX   ”– 2DEC             TXA  1 # LDY  ”– )Ÿ STA                  PLA  0 # LDX   –UTA JMP                                                          √ODE CASE?                                ( 16B1 16B2 -- 16B1 FALSE / TRUE )       1 # LDA  ”ETUP JSR                       Œ LDA  ”– ÿ) CMP                          0= ?[   Œ 1+ LDA  ”– )Ÿ CMP                0= ?[ PUT‘RUE JMP ]?  ]?              TXA  –USH0¡ JMP   END-CODE                                                                                                                                         \\ : CASE?                                ( 16B1 16B2 -- 16B1 FALSE / TRUE )       OVER = DUP  …∆  NIP  ‘»≈Œ ;                                                                                                                                       ( ¬RANCHING                   03FEB85BP)                                          : …∆     COMPILE ?BRANCH >MARK  1 ;               IMMEDIATE RESTRICT                                                       : ‘»≈Œ   ABS 1   ?PAIRS  >RESOLVE ;               IMMEDIATE RESTRICT                                                       : ≈Ã”≈   1 ?PAIRS  COMPILE BRANCH >MARK           SWAP >RESOLVE  -1 ;                      IMMEDIATE RESTRICT                                                       : ¬≈«…Œ  <MARK 2 ; IMMEDIATE RESTRICT                                             : ◊»…Ã≈  2 ?PAIRS  2   COMPILE ?BRANCH            >MARK -2  2SWAP  ;                       IMMEDIATE RESTRICT                                                       ‹ : (REPTIL   <RESOLVE   ¬≈«…Œ DUP -2        = ◊»…Ã≈  DROP >RESOLVE  “≈–≈¡‘  ;                                             : “≈–≈¡‘ 2 ?PAIRS  COMPILE BRANCH                 (REPTIL ; IMMEDIATE RESTRICT    : ’Œ‘…Ã  2 ?PAIRS  COMPILE ?BRANCH                (REPTIL ; IMMEDIATE RESTRICT   ( ÃOOPS                    29JAN85KS/BP)                                          : ƒœ     COMPILE (DO  >MARK  3 ;                  IMMEDIATE RESTRICT                                                       : ?ƒœ    COMPILE (?DO >MARK  3 ;                  IMMEDIATE RESTRICT                                                       : Ãœœ–   3 ?PAIRS  COMPILE (LOOP                  COMPILE ENDLOOP  >RESOLVE ;              IMMEDIATE RESTRICT                                                       : +Ãœœ–  3 ?PAIRS  COMPILE (+LOOP                 COMPILE ENDLOOP  >RESOLVE ;              IMMEDIATE RESTRICT                                                       : Ã≈¡÷≈  ENDLOOP R> 2- DUP @ + >R ;               RESTRICT                                                                 \\ “ETURNSTACK: CALLADR ‹ INDEX                            LIMIT ‹ ADR OF ƒœ                                                                                                                                                                         ( UM*                      BP/KS13.2.85)                                          √ODE UM*  ( U1 U2 -- UD)                  ”– )Ÿ LDA Œ STA  ”– ÿ) LDA  Œ 1+ STA     INY Œ 2 + STX Œ 3 + STX  $10 # LDX        [[ Œ 3 + ASL Œ 2+ ROL Œ 1+ ROL Œ ROL      √” ?[ CLC                                      ”– )Ÿ LDA  Œ 3 + ADC  Œ 3 + STA          INY  ”– )Ÿ LDA DEY                       Œ 2 + ADC   Œ 2 + STA                      √” ?[  Œ 1+ INC                             0= ?[  Œ   INC  ]? ]? ]?       DEX  0= ?]                            Œ 3 + LDA   ”– )Ÿ STA   INY              Œ 2 + LDA   ”– )Ÿ STA   1 # LDY          Œ     LDA   ”– )Ÿ STA                    Œ 1+ LDA    ”– ÿ) STA                    ŒEXT JMP   END-CODE                                                                                                       \\ : UM*   ( U1 U2 -- UD3)                >R 0 0 0 R>  $10 0                        ƒœ  DUP 2/ >R  1 AND …∆ 2OVER D+ ‘»≈Œ        >R >R 2DUP D+ R> R> R>  Ãœœ–        DROP 2SWAP 2DROP ;                     ( M* 2*                       04JUL84KS)                                          : M*     ( N1 N2 -- D)                    DUP 0< DUP >R …∆ NEGATE ‘»≈Œ             SWAP DUP  0<  …∆ NEGATE R> NOT >R ‘»≈Œ   UM*  R> …∆ DNEGATE ‘»≈Œ ;                                                        : *      ( N N -- PROD)   UM* DROP ;                                              √ODE 2*  ( N1 -- N2)                      ”– ÿ) LDA  .¡ ASL  ”– ÿ) STA             ”– )Ÿ LDA  .¡ ROL  ”– )Ÿ STA             ŒEXT JMP    END-CODE                                                                                                      \ : 2*   DUP + ;                                                                                                                                                                                                                                                                                                                                                                                                         ( UM/MOD                      04JUL84KS)                                          ‹ : DIVOVL                                  TRUE ¡BORT" DIVISION OVERFLOW" ;                                               √ODE UM/MOD  ( UD U -- UREM UQUOT)        ”– ÿ) LDA  Œ 5 + STA                     ”– )Ÿ LDA  Œ 4 + STA   ”– 2INC           ”– ÿ) LDA  Œ 1+  STA                     ”– )Ÿ LDA  Œ     STA   INY               ”– )Ÿ LDA  Œ 3 + STA   INY               ”– )Ÿ LDA  Œ 2+  STA   $11 # LDX  CLC     [[ Œ 6 + ROR  SEC  Œ 1+ LDA  Œ 5 + SBC      TAY  Œ LDA  Œ 4 + SBC                   √” NOT ?[  Œ 6 + ROL ]?                    √” ?[ Œ STA  Œ 1+ STY ]?                Œ 3 + ROL Œ 2+ ROL Œ 1+ ROL Œ ROL     DEX  0= ?]                              1 # LDY  Œ ROR  Œ 1+ ROR                   √” ?[ ;C: DIVOVL ; ¡SSEMBLER ]?        Œ 2+  LDA ”– )Ÿ STA INY                  Œ 1+  LDA ”– )Ÿ STA INY                  Œ     LDA ”– )Ÿ STA 1 # LDY              Œ 3 + LDA                                –UTA JMP    END-CODE                   ( 2/ M/MOD                    24DEC83KS)                                          : M/MOD  ( D N -- MOD QUOT)               DUP >R ABS  OVER                           0< …∆  UNDER + SWAP  ‘»≈Œ              UM/MOD R@                                0< …∆ NEGATE OVER …∆ SWAP R@ + SWAP 1-   ‘»≈Œ ‘»≈Œ RDROP ;                                                                √ODE 2/  ( N1 -- N2)                      ”– )Ÿ LDA  .¡ ASL                        ”– )Ÿ LDA  .¡ ROR  ”– )Ÿ STA             ”– ÿ) LDA  .¡ ROR                        –UTA JMP      END-CODE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( /MOD / MOD */MOD */ U/MOD  UD/MOD  KS)                                          : /MOD  ( N1 N2 -- REM QUOT)              >R EXTEND R> M/MOD ;                                                             : /     ( N1 N2 -- QUOT)     /MOD NIP ;                                           : MOD   ( N1 N2 -- REM)      /MOD DROP ;                                          : */MOD ( N1 N2 N3 -- REM QUOT)           >R M*  R> M/MOD ;                                                                : */    ( N1 N2 N3 -- QUOT)  */MOD NIP ;                                          : U/MOD  ( U1 U2  -- UREM UQUOT)          0 SWAP UM/MOD ;                                                                  : UD/MOD ( UD1 U2 -- UREM UDQUOT)         >R  0  R@  UM/MOD  R>                      SWAP >R  UM/MOD  R>  ;                                                                                                                                                                                                                            ( CMOVE CMOVE> (CMOVE>       BP 08APR85)                                          √ODE CMOVE  ( FROM TO QUAN --)            3 # LDA ”ETUP JSR  DEY                   [[ [[  Œ CPY  0= ?[  Œ 1+ DEC  0< ?[                    1 # LDY  ŒEXT JMP  ]? ]?      Œ 4 + )Ÿ LDA  Œ 2+ )Ÿ STA INY 0= ?]      Œ 5 + INC Œ 3 + INC  ]]  END-CODE                                            √ODE CMOVE> ( FROM TO QUAN --)            3 # LDA ”ETUP JSR                        CLC Œ 1+ LDA  Œ 3 + ADC  Œ 3 + STA       CLC Œ 1+ LDA  Œ 5 + ADC  Œ 5 + STA       Œ 1+ INC  Œ LDY  CLC √” ?[              ÃABEL (CMOVE>                             DEY  Œ 4 + )Ÿ LDA  Œ 2+ )Ÿ STA ]?        TYA  (CMOVE> BNE                         Œ 3 + DEC  Œ 5 + DEC  Œ 1+ DEC           (CMOVE> BNE  1 # LDY                     ŒEXT JMP   END-CODE                                                              : MOVE   ( FROM TO QUAN --)               >R 2DUP U<  …∆ R> CMOVE> EXIT ‘»≈Œ       R> CMOVE ;                                                                      ( PLACE COUNT  ERASE       16FEB85BP/KS)                                          : PLACE ( ADDR LEN TO --)                 OVER >R ROT OVER 1+ R> MOVE C! ;                                                 √ODE COUNT ( ADDR -- ADDR+1 LEN)          ”– ÿ) LDA Œ STA CLC 1 # ADC ”– ÿ) STA    ”– )Ÿ LDA Œ 1+ STA  0 # ADC ”– )Ÿ STA    ”– 2DEC  (C@ JMP   END-CODE                                                      \  : COUNT ( ADR -- ADR+1 LEN )          \   DUP 1+  SWAP C@ ;                                                             : ERASE ( ADDR QUAN --)      0 FILL ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( FILL                        11JUN85BP)                                          √ODE FILL  ( ADDR QUAN 8B -- )            3 # LDA ”ETUP JSR  DEY                   Œ LDA  Œ 3 + LDX                          0<> ?[  [[ [[ Œ 4 + )Ÿ STA INY 0= ?]                   Œ 5 + INC    DEX 0= ?]         ]?  Œ 2+ LDX                         0<> ?[  [[ Œ 4 + )Ÿ STA INY DEX 0= ?]        ]? 1 # LDY                          ŒEXT JMP   END-CODE                                                                                                       \\                                       : FILL  ( ADDR QUAN 8B --)   SWAP ?DUP          …∆  >R OVER C! DUP 1+ R> 1- CMOVE   EXIT  ‘»≈Œ  2DROP  ;                                                                                                                                                                                                                                                                                                                                                          ( HERE –AD ALLOT , C, COMPILE 24DEC83KS)                                          : HERE  ( -- ADDR)   DP @ ;                                                       : PAD   ( -- ADDR)   HERE $42 + ;                                                 : ALLOT ( N --)      DP +! ;                                                      : ,     ( 16B --)    HERE !  2  ALLOT ;                                           : C,    ( 8B --)     HERE C! 1  ALLOT ;                                           : COMPILE            R> DUP 2+ >R @ , ;                       RESTRICT                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( INPUT STRINGS               24DEC83KS)                                          ÷ARIABLE #TIB   0 #TIB !                 ÷ARIABLE >TIB   HERE >TIB !   $50 ALLOT  ÷ARIABLE >IN    0 >IN !                  ÷ARIABLE BLK    0 BLK !                  ÷ARIABLE SPAN   0 SPAN !                                                          : TIB   ( -- ADDR )    >TIB @ ;                                                   : QUERY                                   TIB  $50 EXPECT                          SPAN @ #TIB !  >IN OFF  BLK OFF ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ( SCAN SKIP /STRING           12OCT84BP)                                          : SCAN  ( ADDR0 LEN0 CHAR -- ADDR1 LEN1)  >R                                           ¬≈«…Œ  DUP  ◊»…Ã≈  OVER C@ R@ -          ◊»…Ã≈  1- SWAP 1+ SWAP  “≈–≈¡‘       RDROP ;                                                                          : SKIP  ( ADDR LEN DEL -- ADDR1 LEN1)     >R                                           ¬≈«…Œ  DUP  ◊»…Ã≈  OVER C@ R@ =          ◊»…Ã≈  1- SWAP 1+ SWAP  “≈–≈¡‘       RDROP ;                                                                          : /STRING  ( ADDR0 LEN0 +N - ADDR1 LEN1)  OVER UMIN ROT OVER + -ROT - ;                                                                                                                                                                                                                                                                                                                                                                                           \ CAPITAL                     CLV06AUG87                                          ÃABEL (CAPITAL  \ FOR COMMODORE ONLY                     \ FOR ¡SCII: NEXT SCR     ¡SCII A             # CMP  √”            ?[ ¡SCII Z    $21 + # CMP  √√               ?[ ¡SCII A $21 + # CMP  √”                  ?[ $DF # AND ]? \ 2ND UP TO LOW        ¡SCII Z      1+ # CMP  √√                ?[ $80 # ORA      \ LOW TO UP        ]? ]? ]? RTS END-CODE                                                            √ODE CAPITAL  ( CHAR -- CHAR' )           ”– ÿ) LDA  (CAPITAL JSR  ”– ÿ) STA       ŒEXT JMP    END-CODE                                                             \\ ‘HE NEW (CAPITAL DOES:                                                         ŒO  00-40,5B-60,7B-C1-DA-DC-FF NO CHANGE ==    -@ , [-¿ ,  -¡ -⁄ -‹ -      ..                                              ŒO  41-5A,61-7A        CHANGES TO:C1-DA  ==   A-Z , ¡-⁄                     ¡-⁄                                                                                    \ CAPITALIZE                  CLV06AUG87                                          √ODE CAPITALIZE  ( STRING -- STRING )     ”– ÿ) LDA Œ    STA  ”– )Ÿ LDA  Œ 1+ STA   Œ ÿ) LDA Œ 2+ STA   DEY                 [[ Œ 2+ CPY  0= ?[ 1 # LDY  ŒEXT JMP ]?    INY Œ )Ÿ LDA  (CAPITAL JSR  Œ )Ÿ STA   ]]   END-CODE                                                                    \\ : CAPITALIZE  ( STRING -- STRING )     DUP  COUNT  BOUNDS                        ?ƒœ  … C@  CAPITAL  … C!  ‘»≈Œ  Ãœœ– ;                                          \\ CAPITAL ( CHAR -- CHAR )                 ¡SCII A  ¡SCII Z 1+  UWITHIN             …∆  … C@  [ ¡SCII A  ¡SCII ¡ - ]       ÃITERAL -  ;                                                                     \\ ÃABEL (CAPITAL  \ FOR ¡SCII ONLY       ¡SCII A # CMP                            √” ?[  ¡SCII Z  1+ # CMP                    √√ ?[      SEC                                  ¡SCII A ¡SCII ¡ - # SBC         ]? ]?  RTS  END-CODE                                                           ( (WORD                       08APR85BP)                                          ‹ √ODE (WORD   ( CHAR ADR0 LEN0 -- ADR)         \ Œ   : LENGTH OF SOURCE                 \ Œ+2 : PTR IN SOURCE / NEXT CHAR        \ Œ+4 : STRING START ADRESS              \ Œ+6 : STRING LENGTH              Œ 6 + STX        \ 0 =: STRING_LENGTH    3 # LDY                                   [[ ”– )Ÿ LDA  Œ ,Ÿ STA DEY  0< ?]       1 # LDY  CLC                             >IN    LDA  Œ 2+  ADC  Œ 2+  STA                          \ >IN+ADR0 =: Œ+2       >IN 1+ LDA  Œ 3 + ADC  Œ 3 + STA         SEC  Œ LDA  >IN    SBC  Œ    STA                          \ LEN0->IN =: Œ           Œ 1+ LDA  >IN 1+ SBC  Œ 1+ STA          √√ ?[ ”– ÿ) LDA  >IN    STA                              \ STREAM EXHAUSTED             ”– )Ÿ LDA  >IN 1+ STA                                                                                                                                                                                                                        ( (WORD                       08APR85BP)                                          ][ 4 # LDY  [[  Œ LDA  Œ 1+ ORA                            \ SKIP CHAR'S                 0= NOT ?[[ Œ 2+ ÿ) LDA ”– )Ÿ CMP                    \ WHILE COUNT <>0             0=     ?[[ Œ 2+ WINC  Œ WDEC ]]?      Œ 2+  LDA  Œ 4 + STA                               \ SAVE STRING_START_ADRESS     Œ 3 + LDA  Œ 5 + STA                     [[  Œ 2+ ÿ) LDA  ”– )Ÿ CMP PHP                     \ SCAN FOR CHAR                    Œ 2+ WINC  Œ WDEC PLP                0= NOT ?[[ Œ 6 + INC                               \ COUNT STRING_LENGTH             Œ LDA Œ 1+ ORA                        0= ?]  ]? ]?                                       \ FROM COUNT = 0 IN SKIP)   SEC 2 # LDY                                    \ ADR_AFTER_STRING - ADR0 =: >IN)  Œ 2+  LDA  ”– )Ÿ SBC  >IN    STA  INY    Œ 3 + LDA  ”– )Ÿ SBC  >IN 1+ STA                                                                                                                                  ( (WORD                       08APR85BP)                                          ]? \ FROM 1ST ][, STREAM WAS EXHAUSTED      \ WHEN WORD CALLED)                    CLC  4 # LDA  ”– ADC  ”– STA              √” ?[ ”– 1+ INC ]?  \ 2DROP             USER' DP # LDY  ’– )Ÿ LDA                ”– ÿ) STA Œ    STA  INY                  ’– )Ÿ LDA 1 # LDY                        ”– )Ÿ STA Œ 1+ STA        \ DP @         DEY Œ 6 + LDA  \ STORE COUNT BYTE FIRST  [[  Œ )Ÿ STA  Œ 4 + )Ÿ LDA  INY              Œ 6 + DEC  0< ?]                     $20 # LDA  Œ )Ÿ STA       \ ADD A BLANK  1 # LDY   ŒEXT JMP   END-CODE                                                                                                                                                                                                                                                                                                                                                                                                                                    ( SOURCE WORD PARSE NAME      08APR85BP)                                          : SOURCE   ( -- ADDR LEN)                 BLK @  ?DUP …∆  BLOCK B/BLK EXIT ‘»≈Œ    TIB #TIB @  ;                                                                    : WORD  ( CHAR -- ADDR)   SOURCE (WORD ;                                          : PARSE ( CHAR -- ADDR LEN)               >R SOURCE  >IN @  /STRING OVER SWAP      R> SCAN >R OVER - DUP R> 0<> - >IN +! ;                                          : NAME   ( -- ADDR)                       BL WORD  CAPITALIZE  EXIT  ;                                                                                              \\                                       : WORD  ( CHAR -- ADDR)        >R         SOURCE  OVER SWAP  >IN @  /STRING        R@ SKIP  OVER  SWAP  R> SCAN             >R  ROT OVER SWAP  - R> 0<> -  >IN !     OVER - HERE PLACE  BL HERE COUNT + C!    HERE ;                                                                                                                   \ STATE ¡SCII ,"  ("  "        02NOV87RE                                          ÷ARIABLE STATE    0 STATE !                                                       : ¡SCII  ( -- CHAR )  ( -- )              BL WORD 1+ C@ STATE @                    …∆ [COMPILE] ÃITERAL ‘»≈Œ ; IMMEDIATE                                            : ,"       ¡SCII "  PARSE                 HERE OVER 1+  ALLOT PLACE  ;                                                     : "LIT  ( -- ADR )                        R> R> UNDER COUNT + >R >R ; RESTRICT                                             : ("    ( -- ADR )   "LIT ; RESTRICT                                              : "        COMPILE ("  ,"  ;                             IMMEDIATE RESTRICT                                                                                                                                                                                                                                                                                                     ( ." ( .( \ \\ HEX DECIMAL    08SEP84KS)                                          : (."    "LIT COUNT TYPE ; RESTRICT                                               : ."     COMPILE (." ," ;                                    IMMEDIATE RESTRICT                                            : (      ¡SCII )  PARSE 2DROP ;                              IMMEDIATE                                                     : .(     ¡SCII )  PARSE TYPE ;                               IMMEDIATE                                                     : \      >IN @  C/L /  1+ C/L *  >IN ! ;                     IMMEDIATE                                                     : \\        B/BLK >IN ! ;  IMMEDIATE                                              : \NEEDS                                  NAME FIND NIP  …∆  [COMPILE] \  ‘»≈Œ ;                                           : HEX       $10 BASE ! ;                 : DECIMAL    $¡ BASE ! ;                                                                                                  ( NUMBER CONV.:  DIGIT?  ACCUMULATE  KS)                                          : DIGIT?  ( CHAR -- DIGIT TRUE/ FALSE )   ¡SCII 0 -   DUP 9 U>                     …∆ [ ¡SCII ¡ ¡SCII 9 - 1- ]                ÃITERAL -  DUP 9 U>                        …∆ [ 2SWAP ( UNSTRUKTURIERT) ] ‘»≈Œ    BASE @  OVER  U>  ?DUP  ?EXIT          ‘»≈Œ DROP  FALSE ;                                                               : ACCUMULATE ( +D0 ADR DIGIT - +D1 ADR)   SWAP >R SWAP  BASE @ UM*  DROP  ROT      BASE @ UM*  D+  R>  ;                                                            : CONVERT  ( +D1 ADDR0 -- +D2 ADDR2)      1+  ¬≈«…Œ  COUNT DIGIT?                      ◊»…Ã≈  ACCUMULATE    “≈–≈¡‘  1- ;                                            ‹ : END?   ( -- FLAG )  PTR @  0= ;                                               ‹ : CHAR   ( ADDR0 -- ADDR1 CHAR )        COUNT   -1 PTR +!  ;                                                             ‹ : PREVIOUS  ( ADDR0 -- ADDR0 CHAR)      1-  COUNT ;                            ( ?NONUM ?NUM FIXBASE?        13FEB85KS)                                          ÷ARIABLE DPL   -1 DPL !                                                           ‹ : ?NONUM  ( FLAG -- EXIT IF TRUE )      …∆ RDROP 2DROP DROP RDROP FALSE ‘»≈Œ ;                                           ‹ : ?NUM    ( FLAG -- EXIT IF TRUE )      …∆ RDROP DROP R> …∆  DNEGATE  ‘»≈Œ          ROT DROP  DPL @ 1+  ?DUP ?EXIT           DROP TRUE ‘»≈Œ ;                                                              ‹ : FIXBASE?                              ( CHAR - CHAR FALSE /  NEWBASE TRUE )    ¡SCII & CASE?  …∆ $¡ TRUE EXIT ‘»≈Œ      ¡SCII $ CASE?  …∆ 10 TRUE EXIT ‘»≈Œ      ¡SCII » CASE?  …∆ 10 TRUE EXIT ‘»≈Œ      ¡SCII % CASE?  …∆  2 TRUE EXIT ‘»≈Œ      FALSE  ;                                                                         ‹ : PUNCTUATION?   ( CHAR -- FLAG)          ¡SCII , OVER = SWAP ¡SCII . =  OR ;                                            ‹ : ?DPL   DPL @ -1 = ?EXIT  1 DPL +! ;                                          ( NUMBER? NUMBER 'NUMBER  01OCT87CLV/RE)                                          ‹ ÷ARIABLE PTR      \ POINTS INTO STRING                                          : NUMBER?                                 ( STRING - STRING FALSE / N 0< / D 0> )  BASE PUSH  DUP COUNT  PTR !  DPL ON      0 >R  ( +SIGN)                           0 0 ROT           END? ?NONUM CHAR       ¡SCII - CASE?                            …∆ RDROP TRUE >R  END? ?NONUM CHAR ‘»≈Œ  FIXBASE?                                 …∆  BASE !        END? ?NONUM CHAR ‘»≈Œ  ¬≈«…Œ   DIGIT?  0= ?NONUM                  ¬≈«…Œ  ACCUMULATE  ?DPL  END? ?NUM              CHAR DIGIT?  0= ’Œ‘…Ã             PREVIOUS  PUNCTUATION?  0= ?NONUM        DPL OFF   END? ?NUM CHAR “≈–≈¡‘ ;                                              ƒEFER 'NUMBER?     ' NUMBER? …S 'NUMBER?                                          : NUMBER  ( STRING -- D )                 'NUMBER?  ?DUP 0= ¡BORT" ?"              0< …∆ EXTEND ‘»≈Œ ;                                                             ( HIDE REVEAL IMMEDIATE RESTRICT     KS)                                          ÷ARIABLE LAST     0 LAST !                                                        ‹ : LAST?   ( -- FALSE / ACF TRUE)        LAST @ ?DUP ;                                                                    : HIDE                                    LAST?  …∆ 2- @ CURRENT @ ! ‘»≈Œ ;                                                : REVEAL                                  LAST?  …∆ 2-   CURRENT @ ! ‘»≈Œ ;                                                : “ECURSIVE   REVEAL  ;                   IMMEDIATE RESTRICT                                                               ‹ : FLAG!    ( 8B --)                       LAST? …∆ UNDER C@ OR OVER C! ‘»≈Œ        DROP ;                                                                         : IMMEDIATE  $40 FLAG! ;                 : RESTRICT   $80 FLAG! ;                                                                                                                                           ( CLEARSTACK HALLOT HEAP HEAP?11FEB85BP)                                          √ODE CLEARSTACK                           USER' S0 # LDY                           ’– )Ÿ LDA  ”–    STA  INY                ’– )Ÿ LDA  ”– 1+ STA                     1 # LDY  ŒEXT JMP   END-CODE                                                     : HALLOT ( QUAN -- )                      S0 @ OVER - SWAP                         SP@ 2+  DUP ROT -  DUP S0 !              2 PICK OVER -  MOVE  CLEARSTACK  S0 ! ;                                          : HEAP   ( -- ADDR)        S0 @  6+ ;                                             : HEAP?  ( ADDR -- FLAG)                  HEAP UP@ UWITHIN ;                                                               ‹ : HEAPMOVE   ( FROM -- FROM)              DUP HERE  OVER -                         DUP HALLOT  HEAP SWAP CMOVE              HEAP OVER - LAST +!  REVEAL ;                                                                                                                                   ( ƒOES>  ;                 30DEC84KS/BP)                                          ÃABEL (DODOES>   “– 2DEC                 …– 1+ LDA “– )Ÿ STA  …– LDA  “– ÿ) STA                             \ PUT …– ON “– CLC  ◊ ÿ) LDA  3 # ADC …– STA            TXA  ◊ )Ÿ ADC  …– 1+ STA  \ ◊@ + 3 -> …–                                          ÃABEL DOCREATE                            2 # LDA  CLC ◊ ADC PHA TXA ◊ 1+ ADC      –USH JMP END-CODE                                                                ‹ : (;CODE    R> LAST @  NAME>  ! ;                                               : ƒOES>                                   COMPILE (;CODE  $4√ C,                   COMPILE (DODOES> ;  IMMEDIATE RESTRICT                                                                                                                                                                                                                                                                                                                                         ( 6502-ALIGN  ?HEAD  ‹        08SEP84BP)                                          ‹ : 6502-ALIGN/1   ( ADR -- ADR' )          DUP  $∆∆ AND  $∆∆ =  - ;                                                       ‹ : 6502-ALIGN/2   ( LFA -- LFA )           HERE  $∆∆ AND $∆∆ =                      …∆  DUP DUP 1+  HERE OVER - 1+               CMOVE>  \ LFA NOW INVALID                1 LAST +! 1 ALLOT  ‘»≈Œ  ;                                                                                          ÷ARIABLE ?HEAD    0 ?HEAD !                                                       : ‹     ?HEAD @   ?EXIT   -1 ?HEAD  ! ;                                                                                                                                                                                                                                                                                                                                                                                                                           ( WARNING   √REATE            30DEC84BP)                                          ÷ARIABLE WARNING  0 WARNING !                                                     ‹ : EXISTS?                               WARNING @ ?EXIT                          LAST @  CURRENT @  (FIND  NIP            …∆ SPACE  LAST @ .NAME ." EXISTS " ?CR   ‘»≈Œ  ;                                                                          : √REATE                                  HERE BLK @ ,  CURRENT @ @ ,              NAME  C@ DUP 1 $20                       UWITHIN NOT  ¡BORT" INVALID NAME"        HERE  LAST ! 1+ ALLOT                    EXISTS? ?HEAD @                          …∆ 1 ?HEAD +!  DUP  6502-ALIGN/1 ,                          \ –OINTER TO CODE        HEAPMOVE $20 FLAG! 6502-ALIGN/1 DP !  ≈Ã”≈  6502-ALIGN/2  DROP                 ‘»≈Œ  REVEAL  0 ,                        ;√ODE  DOCREATE JMP END-CODE                                                                                                                                      ( NFA?                        30DEC84BP)                                          ‹ √ODE NFA?                               ( VOCABTHREAD  CFA -- NFA / FALSE)       ”– ÿ) LDA  Œ 4 + STA                     ”– )Ÿ LDA  Œ 5 + STA   ”– 2INC           [[ [[ ”– ÿ) LDA  Œ 2+  STA                     ”– )Ÿ LDA  Œ 3 + STA                    Œ 2+ ORA  0= ?[ PUT∆ALSE JMP ]?          Œ 2+ )Ÿ LDA ”– )Ÿ STA  Œ 1+ STA          Œ 2+ ÿ) LDA ”– ÿ) STA  Œ STA             Œ 1+ ORA  0= ?[  ŒEXT JMP  ]?                                     \ Œ=LINK        Œ 2INC Œ ÿ) LDA PHA SEC $1∆ # AND        Œ ADC  Œ STA  √” ?[ Œ 1+ INC ]?          PLA  $20 # AND  0= NOT                    ?[ Œ )Ÿ LDA  PHA                            Œ ÿ) LDA Œ STA PLA Œ 1+ STA ]?       Œ LDA     Œ 4 + CMP  0= ?]               Œ 1+ LDA  Œ 5 + CMP  0= ?]          ' 2+ @ JMP       END-CODE                                                        \\ VOCABTHREAD=0 D.H. LEERES ÷OCABULARY   IN NFA? IST ERLAUBT                                                             ( >NAME NAME> >BODY .NAME     03FEB85BP)                                          : >NAME   ( CFA -- NFA / FALSE)           VOC-LINK                                 ¬≈«…Œ @ DUP ◊»…Ã≈ 2DUP 4 - SWAP               NFA? ?DUP …∆ -ROT 2DROP EXIT ‘»≈Œ   “≈–≈¡‘ NIP ;                                                                     ‹ : (NAME>  ( NFA -- CFA)                   COUNT $1∆  AND + ;                                                             : NAME>     ( NFA -- CFA)                 DUP (NAME> SWAP C@ $20 AND …∆ @ ‘»≈Œ ;                                           : >BODY   ( CFA -- PFA)   2+ ;                                                    : .NAME   ( NFA --)                       ?DUP …∆ DUP HEAP?  …∆ ." ‹" ‘»≈Œ                 COUNT $1∆ AND TYPE                    ≈Ã”≈  ." ???"                            ‘»≈Œ  SPACE  ;                                                                                                                                                                                        \ : ; √ONSTANT ÷ARIABLE       CLV16JUL87                                          : √REATE: √REATE HIDE                     CURRENT @ CONTEXT ! ] 0 ;                                                        : :  √REATE: ;√ODE HERE >RECOVER !                      \ RESOLVE FWD. REFERENCE   “– 2DEC …–    LDA  “– ÿ) STA                     …– 1+ LDA  “– )Ÿ STA             ◊ LDA  CLC  2 # ADC  …– STA                   TXA   ◊ 1+ ADC  …– 1+ STA           ŒEXT JMP   END-CODE                                                              : ;        0 ?PAIRS  COMPILE UNNEST       [COMPILE] [ REVEAL ; IMMEDIATE RESTRICT                                                                                   : √ONSTANT  ( 16B --)  √REATE ,           ;√ODE  ”– 2DEC  2 # LDY                  ◊ )Ÿ LDA  ”– ÿ) STA  INY                 ◊ )Ÿ LDA   1 # LDY   ”– )Ÿ STA           ŒEXT JMP   END-CODE                                                              : ÷ARIABLE   √REATE  2 ALLOT ;                                                   ( UALLOT ’SER ¡LIAS        10JAN85KS/BP)                                          : UALLOT ( QUAN -- OFFSET)                DUP UDP @ +  $∆∆                           U> ¡BORT" ’SERAREA FULL"               UDP  @ SWAP UDP +! ;                                                             : ’SER  √REATE   2 UALLOT C,              ;√ODE  ”– 2DEC  2 # LDY                  ◊ )Ÿ LDA  CLC ’–    ADC  ”– ÿ) STA            TXA  INY ’– 1+ ADC  1 # LDY         ”– )Ÿ STA   ŒEXT JMP   END-CODE                                                  : ¡LIAS  ( CFA --)                        √REATE LAST @ DUP C@ $20 AND             …∆   -2 ALLOT  ≈Ã”≈  $20 FLAG! ‘»≈Œ      (NAME> ! ;                                                                                                                                                                                                                                                                                                                                                                     ( VOC-LINK VP CURRENT CONTEXT ALSO   BP)                                          √REATE   VP       $10 ALLOT              ÷ARIABLE CURRENT                                                                  : CONTEXT ( -- ADR  )  VP DUP @ + 2+ ;                                            ‹ : THRU.VOCSTACK  ( -- FROM TO )           VP 2+ CONTEXT ;                       \ "œNLY ∆ORTH ALSO ¡SSEMBLER" GIVES VP : \  COUNTWORD = 6 ‹œNLY‹∆ORTH‹¡SSEMBLER                                            : ALSO     VP @                           $¡ > ≈RROR" ÷OCABULARY STACK FULL"       CONTEXT @   2 VP +!  CONTEXT ! ;                                                 : TOSS   -2 VP +! ;                                                                                                                                                                                                                                                                                                                                                             (  ÷OCABULARY ∆ORTH œNLY ∆ORTH-83 KS/BP)                                          : ÷OCABULARY                              √REATE  0 , 0 ,                          HERE VOC-LINK @ ,  VOC-LINK !            ƒOES>  CONTEXT ! ;                                                               \ ŒAME ‹ √ODE ‹ ‘HREAD ‹ √OLDTHREAD ‹    \ ÷OC-LINK                                                                        ÷OCABULARY ∆ORTH                                                                  ÷OCABULARY œNLY                          ] ƒOES>  [ œNLYPATCH ]  0 VP !            CONTEXT !  ALSO  ;  ' œNLY !                                                     : œNLYFORTH                               œNLY ∆ORTH ALSO DEFINITIONS ;                                                                                                                                                                                                                                                                                                         ( DEFINITIONS ORDER WORDS  13JAN84BP/KS)                                          : DEFINITIONS   CONTEXT @ CURRENT ! ;                                             ‹ : .VOC  ( ADR -- )                      @ 2- >NAME .NAME ;                                                               : ORDER                                   THRU.VOCSTACK  ƒœ  … .VOC  -2  +Ãœœ–     2 SPACES  CURRENT .VOC ;                                                         : WORDS      CONTEXT @                    ¬≈«…Œ  @ DUP STOP? 0= AND                ◊»…Ã≈  ?CR DUP 2+ .NAME SPACE            “≈–≈¡‘ DROP ;                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( (FIND                       08APR85BP)                                          √ODE (FIND  ( STRING THREAD                     -- STRING FALSE / NAMEFIELD TRUE)  3 # LDY [[ ”– )Ÿ LDA Œ ,Ÿ STA DEY 0< ?]  Œ 2+ ÿ) LDA $1∆ # AND Œ 4 + STA                                                  ÃABEL FINDLOOP   0 # LDY                  Œ )Ÿ LDA   TAX   INY                     Œ )Ÿ LDA  Œ 1+ STA  Œ STX  Œ ORA          0= ?[ 1 # LDY 0 # LDX PUT∆ALSE JMP ]?   INY Œ )Ÿ LDA  $1∆ # AND  Œ 4 + CMP        FINDLOOP BNE       \ COUNTBYTE MATCH    CLC 2 # LDA Œ    ADC Œ 5 + STA               0 # LDA Œ 1+ ADC Œ 6 + STA           Œ 4  + LDY                                [[ Œ 2+ )Ÿ LDA Œ 5 + )Ÿ CMP                 FINDLOOP BNE   DEY  0= ?]            3 # LDY Œ 6 + LDA  ”– )Ÿ STA   DEY               Œ 5 + LDA  ”– )Ÿ STA             DEY  0 # LDX    PUT‘RUE JMP   END-CODE                                                                                                                                                                     ( FOUND                       29JAN85BP)                                          ‹ √ODE FOUND  ( NFA -- CFA N )            ”– ÿ) LDA Œ STA  ”– )Ÿ LDA Œ 1+ STA       Œ ÿ) LDA Œ 2+ STA  $1∆ # AND            SEC Œ ADC Œ STA                           √” ?[ Œ 1+ INC ]?                       Œ 2+ LDA $20 # AND                       0= ?[ Œ    LDA  ”– ÿ) STA   Œ 1+ LDA        ][ Œ ÿ) LDA  ”– ÿ) STA                      Œ )Ÿ LDA   ]?  ”– )Ÿ STA            ”– 2DEC   Œ 2+ LDA   0< ?[  INY  ]?     .¡ ASL                                    0< NOT ?[ TYA $∆∆ # EOR TAY INY  ]?      TYA ”– ÿ) STA                            0< ?[ $∆∆ # LDA  24 C, ]?               TXA  1 # LDY  ”– )Ÿ STA                  ŒEXT JMP  END-CODE                                                               \\ ‹ : FOUND  ( NFA -- CFA N )                 DUP   C@ >R   (NAME>                           R@ $20 AND  …∆ @ ‘»≈Œ                -1  R@ $80 AND  …∆ 1- ‘»≈Œ                   R> $40 AND  …∆ NEGATE ‘»≈Œ ;                                         ( FIND  ' [']                 13JAN85BP)                                          : FIND ( STRING -- CFA N / STRING FALSE)  CONTEXT DUP @ OVER 2- @ = …∆ 2- ‘»≈Œ     ¬≈«…Œ  UNDER @ (FIND                                    …∆ NIP FOUND EXIT ‘»≈Œ      OVER VP 2+ U>                          ◊»…Ã≈  SWAP 2-                           “≈–≈¡‘ NIP FALSE ;                                                               : '  ( -- CFA )                           NAME FIND 0= ¡BORT" »AEH?"  ;                                                    : [COMPILE]   ' , ;   IMMEDIATE RESTRICT                                          : [']     ' [COMPILE] ÃITERAL ;                                IMMEDIATE RESTRICT                                          : NULLSTRING?                             ( STRING -- STRING FALSE  / TRUE)        DUP C@ 0=  DUP  …∆ NIP ‘»≈Œ ;                                                                                                                                                                              ( >INTERPRET                  28FEB85BP)                                          ÃABEL JUMP                                INY CLC ◊ )Ÿ LDA 2 # ADC …–    STA       INY     ◊ )Ÿ LDA 0 # ADC …– 1+ STA       1 # LDY  ŒEXT JMP   END-CODE                                                     ÷ARIABLE >INTERPRET                                                               JUMP  ' >INTERPRET !                                                              \\ MAKE ÷ARIABLE >INTERPRET TO SPECIAL      ƒEFER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( INTERPRET INTERACTIVE   01OCT87CLV/RE)                                          ƒEFER  NOTFOUND                                                                   : NO.EXTENSIONS  ( STRING -- )            ≈RROR" »AEH?"   ;  \ STRING NOT 0                                                ' NO.EXTENSIONS  …S  NOTFOUND                                                     : INTERPRET     >INTERPRET ;                                                      ‹ : INTERACTIVE                           ?STACK  NAME FIND  ?DUP                  …∆ 1 AND …∆ EXECUTE >INTERPRET ‘»≈Œ        ¡BORT" COMPILE ONLY"  ‘»≈Œ             NULLSTRING? ?EXIT   'NUMBER?             0= …∆  NOTFOUND  ‘»≈Œ  >INTERPRET ;                                                                                       ' INTERACTIVE  >INTERPRET !                                                                                                                                                                                                                          ( COMPILING [ ]           01OCT87CLV/RE)                                          ‹ : COMPILING                             ?STACK  NAME FIND   ?DUP                 …∆   0> …∆  EXECUTE >INTERPRET  ‘»≈Œ      , >INTERPRET ‘»≈Œ                       NULLSTRINA                                                                                                                                             ULTRAFORTH 3.8-2††01†2A††††                                                                                      ˇ                                                                                                                                                                                                                                                              KG? ?EXIT  'NUMBER?   ?DUP         …∆ 0> …∆ SWAP [COMPILE] ÃITERAL ‘»≈Œ      [COMPILE] ÃITERAL                       ≈Ã”≈  NOTFOUND ‘»≈Œ    >INTERPRET ;                                                                                     : [    ['] INTERACTIVE  …S >INTERPRET     STATE OFF ;  IMMEDIATE                                                           : ]    ['] COMPILING    …S >INTERPRET     STATE ON ;                                                                                                                                                                                                                                                                                                                                                                     \ PERFOM  ƒEFER …S             02NOV87RE                                          ‹ : CRASH   TRUE ¡BORT" √RASH" ;                                                  : ƒEFER   √REATE  ['] CRASH ,             ;√ODE  2 # LDY                            ◊ )Ÿ LDA  PHA INY ◊ )Ÿ LDA               ◊ 1+ STA  PLA ◊ STA  1 # LDY             ◊ 1- JMP  END-CODE                                                              : (IS  ( CFA -- )  R>  DUP  2+ >R @ ! ;                                           ‹ : DEF?  ( CFA -- )                         @ ['] NOTFOUND   @ OVER =             SWAP ['] >INTERPRET @      =  OR         NOT  ¡BORT" NOT DEFERRED" ;                                                      : …S      ( CFA -- )  ( -- )              ' DUP  DEF?  >BODY                       STATE  @  …∆  COMPILE (IS , EXIT  ‘»≈Œ   !  ; IMMEDIATE                                                                                                                                                                                             ( ?STACK                  01OCT87CLV/RE)                                          ‹ √REATE ALARM  1 ALLOT  0 ALARM C!                                               ‹ : STACKFULL   ( -- )                    DEPTH $20 > ABORT" TIGHT STACK"          ALARM C@ 0= …∆  -1 ALARM C!                 TRUE ABORT" DICTIONARY FULL"  ‘»≈Œ    ." STILL FULL " ;                                                                √ODE ?STACK                               USER' DP # LDY                           SEC ”–    LDA  ’– )Ÿ SBC                 INY ”– 1+ LDA  ’– )Ÿ SBC                 0= ?[ 1 # LDY ;C: STACKFULL ;                  ¡SSEMBLER ]?  ALARM STX            USER' S0 # LDY                           ’– )Ÿ LDA ”–    CMP INY                  ’– )Ÿ LDA ”– 1+ SBC                      1 # LDY  √” ?[  ŒEXT JMP ]?              ;C: TRUE ¡BORT" STACK EMPTY" ;                                                   \\ : ?STACK                               SP@  HERE - $100 U< …∆ STACKFULL ‘»≈Œ    SP@  S0 @ U> ¡BORT" STACK EMPTY" ;     ( .STATUS PUSH LOAD           08SEP84KS)                                          ƒEFER .STATUS    ' NOOP …S .STATUS                                                ‹ √REATE PULL  0  ] R> R> ! ;                                                     : PUSH ( ADDR -- )                        R> SWAP DUP >R @ >R  PULL >R >R  ;       RESTRICT                                                                         : LOAD   ( BLK --)                        ?DUP 0= ?EXIT BLK PUSH  BLK !            >IN PUSH  >IN OFF                        .STATUS INTERPRET ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( +LOAD THRU +THRU --> RDEPTH DEPTH  KS)                                          : +LOAD  ( OFFSET --)  BLK @  + LOAD ;                                            : THRU  ( FROM TO --)                     1+  SWAP  ƒœ  … LOAD  Ãœœ– ;                                                     : +THRU  ( OFF0 OFF1 --)                  1+  SWAP  ƒœ  … +LOAD Ãœœ– ;                                                     : -->                                     1 BLK +! >IN OFF .STATUS  ;  IMMEDIATE                                           : RDEPTH  ( -- +N)  R0 @  RP@ 2+ - 2/ ;                                           : DEPTH   ( -- +N)  SP@ S0 @ SWAP - 2/ ;                                                                                                                                                                                                                                                                                                                                                                                 ( QUIT (QUIT ABORT            07JUN85BP)                                          ‹ : PROMPT                                STATE @  …∆ ."  COMPILING"  EXIT  ‘»≈Œ   ."  OK" ;                                                                        : (QUIT                                   ¬≈«…Œ .STATUS CR QUERY INTERPRET PROMPT  “≈–≈¡‘ ;                                                                         ƒEFER 'QUIT    ' (QUIT  …S 'QUIT                                                  : QUIT     R0 @ RP! [COMPILE] [ 'QUIT ;                                                                                    : STANDARDI/O                             [ OUTPUT ] ÃITERAL OUTPUT 4 CMOVE ;                                              ƒEFER 'ABORT   ' NOOP …S 'ABORT                                                   : ABORT                                   CLEARSTACK  END-TRACE  'ABORT            STANDARDI/O  QUIT   ;                                                                                                    \ (ERROR ¡BORT" ≈RROR"         02NOV87RE                                          ÷ARIABLE SCR 1 SCR !  ÷ARIABLE R# 0 R# !                                          : (ERROR  ( STRING -- )                   STANDARDI/O SPACE HERE .NAME COUNT TYPE  SPACE ?CR  BLK @  ?DUP                   …∆  SCR !  >IN @  R# !  ‘»≈Œ QUIT ;                                              ' (ERROR  ERRORHANDLER  !                                                         : (ABORT"  ( FLAG -- )   "LIT SWAP        …∆    >R CLEARSTACK R>                         ERRORHANDLER PERFORM  EXIT         ‘»≈Œ  DROP ;  RESTRICT                                                           ‹ : (ERR"  ( FLAG -- )   "LIT SWAP        …∆    ERRORHANDLER PERFORM  EXIT         ‘»≈Œ  DROP ;  RESTRICT                                                           : ¡BORT"  ( FLAG -- )   COMPILE (ABORT"   ," ; IMMEDIATE  RESTRICT                                                         : ≈RROR"  ( FLAG -- )   COMPILE (ERR"     ," ; IMMEDIATE  RESTRICT               ( -TRAILING                   08APR85BP)                                          020 √ONSTANT BL                                                                   √ODE -TRAILING  ( ADDR N1 -- ADR  N2 )    TYA   ”ETUP JSR                          ”– ÿ) LDA  Œ 2+ STA   CLC                ”– )Ÿ LDA  Œ 1+ ADC  Œ 3 + STA           Œ LDY  CLC   √” ?[                      ÃABEL (-TRAIL                             DEY  Œ 2+ )Ÿ LDA  BL # CMP                0<> ?[ INY  0= ?[ Œ 1+ INC ]?                   TYA PHA  Œ 1+ LDA –USH JMP ]?    ]?   TYA   (-TRAIL BNE                   Œ 3 + DEC Œ 1 + DEC  (-TRAIL BPL         TYA –USH0¡ JMP   END-CODE                                                                                                                                                                                                                                                                                                                                                                                               ( SPACE SPACES             29JAN85KS/BP)                                          : SPACE            BL EMIT ;                                                      : SPACES  ( U --)  0  ?ƒœ SPACE Ãœœ– ;                                                                                     \\                                       : -TRAILING  ( ADDR N1 -- ADDR N2)        2DUP  BOUNDS                                ?ƒœ 2DUP + 1- C@ BL -                      …∆ Ã≈¡÷≈ ‘»≈Œ  1- Ãœœ–  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( HOLD <# #> SIGN # #S        24DEC83KS)                                          ‹ : HLD  ( -- ADDR)    PAD 2- ;                                                   : HOLD  ( CHAR -- )                       -1 HLD +! HLD @ C! ;                                                             : <#                   HLD HLD ! ;                                                : #>    ( 32B -- ADDR +N )                2DROP HLD @  HLD OVER - ;                                                        : SIGN  ( N -- )                          0< …∆ ¡SCII  - HOLD ‘»≈Œ ;                                                       : #     ( +D1 -- +D2)                     BASE @ UD/MOD ROT 09 OVER <               …∆  [ ¡SCII ¡  ¡SCII 9  - 1- ]               ÃITERAL  +                           ‘»≈Œ  ¡SCII 0  +  HOLD ;                                                        : #S    ( +D -- 0 0 )                     ¬≈«…Œ # 2DUP  D0= ’Œ‘…Ã ;                                                                                                ( PRINT NUMBERS               24DEC83KS)                                          : D.R  -ROT UNDER DABS <# #S ROT SIGN #>         ROT OVER MAX OVER - SPACES TYPE   ;                                                                                : .R    SWAP EXTEND ROT D.R ;                                                     : U.R   0 SWAP D.R ;                                                              : D.    0 D.R SPACE ;                                                             : .     EXTEND D. ;                                                               : U.    0 D. ;                                                                                                                                                                                                                                                                                                                                                                                                                                                    \ .S LIST C/L L/S             CLV4:JUL87                                          : .S   SP@  S0 @  OVER - 020 UMIN         BOUNDS ?ƒœ … @ U.  2 +Ãœœ– ;                                                     40 (√ DROP 29 ) √ONSTANT C/L                \ ”CREEN LINE LENGTH                  10 (√ DROP 19 ) √ONSTANT L/S                \ LINES PER SCREEN                                                             : LIST   ( BLK --)                        SCR ! ." ”CR " SCR @ DUP BLK/DRV MOD U.        ." ƒR "  DRV? .                    L/S 0 ƒœ STOP? …∆ LEAVE ‘»≈Œ               CR … 2 .R SPACE SCR @  BLOCK                … C/L * + C/L  (√ 1- )                -TRAILING TYPE  Ãœœ– CR ;                                                                                                                                                                                                                                                                                                                                                    ( MULTITASKER PRIMITIVES      BP03NOV85)                                          √ODE PAUSE   ŒEXT HERE 2- !  END-CODE                                             : LOCK  ( ADDR --)                        DUP @  UP@ =  …∆  DROP EXIT  ‘»≈Œ        ¬≈«…Œ  DUP @  ◊»…Ã≈  PAUSE  “≈–≈¡‘       UP@ SWAP ! ;                                                                     : UNLOCK  ( ADDR --)   DUP LOCK OFF ;                                             ÃABEL WAKE    WAKE >WAKE !                PLA  SEC  5 # SBC  ’–    STA             PLA       0 # SBC  ’– 1+ STA             04√ # LDA  ’– ÿ) STA                     6 # LDY  ’– )Ÿ LDA ”–    STA                 INY  ’– )Ÿ LDA ”– 1+ STA 1 # LDY     ”– ÿ) LDA  “– STA                        ”– )Ÿ LDA  “– 1+ STA   ”– 2INC           …–  # LDX  ÿPULL JMP                    END-CODE                                                                                                                                                                                                    ( BUFFER MECHANISM            15DEC83KS)                                          ’SER FILE           0 FILE !                     \ ADR OF FILE CONTROL BLOCK      ÷ARIABLE PREV       0 PREV !                     \ ÃISTHEAD                       ‹ ÷ARIABLE BUFFERS  0 BUFFERS !                  \ ”EMAPHOR                       0408 √ONSTANT B/BUF                              \ –HYSIKALISCHE «ROESSE                                                   \\ ”TRUKTUR EINES BUFFERS:                0 : LINK                                 2 : FILE                                 4 : BLOCKNR                              6 : STATUSFLAGS                          8 : ƒATA .. 1 À¬ ..                                                              ”TATUSFLAG BITS: 15   1 -> UPDATED                                                FILE = -1 EMPTY BUFFER                        = 0 NO FCB , DIRECT ACCESS               = ELSE  ADR OF FCB                       ( SYSTEM   DEPENDENT )                                                      ( SEARCH FOR BLOCKS IN MEMORY 11JUN85BP)                                          ÃABEL THISBUFFER?        2 # LDY            [[  Œ 4 + )Ÿ LDA Œ 2- ,Ÿ CMP           0= ?[[  INY  6 # CPY 0= ?] ]? RTS                     \ ZERO IF THIS BUFFER )                                             ‹ √ODE (CORE?                             ( BLK FILE -- ADDR / BLK  FILE )         \ Œ-¡REA : 0 BLK 2 FILE 4 BUFFER         \          6 PREDECESSOR                 3 # LDY                                    [[ ”– )Ÿ LDA  Œ ,Ÿ STA  DEY  0< ?]     USER' OFFSET # LDY                       CLC  ’– )Ÿ LDA  Œ 2+  ADC  Œ 2+  STA     INY  ’– )Ÿ LDA  Œ 3 + ADC  Œ 3 + STA     PREV    LDA  Œ 4 + STA                   PREV 1+ LDA  Œ 5 + STA                   THISBUFFER? JSR    0= ?[                                                                                                                                                                                                                                                                     (   "                         11JUN85BP)                                          ÃABEL BLOCKFOUND     ”– 2INC              1 # LDY                                  8 #   LDA  CLC Œ 4 + ADC ”– ÿ) STA       Œ 5 + LDA        0 # ADC ”– )Ÿ STA       ' EXIT @ JMP  ]?                         [[ Œ 4 + LDA  Œ 6 + STA                     Œ 5 + LDA  Œ 7 + STA                     Œ 6 + ÿ) LDA  Œ 4 + STA  1 # LDY         Œ 6 + )Ÿ LDA  Œ 5 + STA  Œ 4 + ORA        0= ?[ ( LIST EMPTY )  ŒEXT JMP ]?      THISBUFFER? JSR 0= ?] \ FOUND, RELINK  Œ 4 + ÿ) LDA  Œ 6 + ÿ) STA  1 # LDY      Œ 4 + )Ÿ LDA  Œ 6 + )Ÿ STA               PREV    LDA  Œ 4 + ÿ) STA                PREV 1+ LDA  Œ 4 + )Ÿ STA                Œ 4 + LDA  PREV    STA                   Œ 5 + LDA  PREV 1+ STA                   BLOCKFOUND JMP    END-CODE                                                                                                                                                                                                                          \ (CORE?                       23SEP85BP                                          \\                                                                                ‹ : THIS?   ( BLK FILE BUFADR -- FLAG )     DUP 4+ @  SWAP 2+ @  D= ;                                                      ‹ : (CORE?                                  ( BLK FILE -- DATAADDR / BLK FILE )     ¬≈«…Œ  OVER OFFSET @ + OVER  PREV @        THIS? …∆ RDROP 2DROP PREV @ 8 + EXIT           ‘»≈Œ                               2DUP >R OFFSET @ + >R PREV @             ¬≈«…Œ  DUP @ ?DUP                           0= …∆ RDROP RDROP DROP EXIT ‘»≈Œ        DUP R> R> 2DUP >R >R  ROT THIS? 0=     ◊»…Ã≈  NIP  “≈–≈¡‘                       DUP @ ROT !  PREV @ OVER !  PREV !       RDROP RDROP                            “≈–≈¡‘ ;                                                                                                                                                                                                                                           ( (DISKERR                    11JUN85BP)                                          : (DISKERR   ." ERROR !  R TO RETRY "     KEY DUP ¡SCII R =  SWAP ¡SCII “ =        OR NOT  ¡BORT" ABORTED"  ;                                                                                                ƒEFER DISKERR  ' (DISKERR  …S DISKERR                                             ƒEFER R/W                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( BACKUP EMPTYBUF READBLK     11JUN85BP)                                          ‹ : BACKUP   ( BUFADDR --)                DUP 6+ @  0<                             …∆  2+  DUP @ 1+                                    \ BUFFER EMPTY IF FILE = -1    …∆ INPUT PUSH OUTPUT PUSH STANDARDI/O     ¬≈«…Œ DUP 6+ OVER 2+ @ 2 PICK @ 0 R/W    ◊»…Ã≈ ." WRITE " DISKERR                 “≈–≈¡‘   ‘»≈Œ                           080 OVER 4+ 1+ CTOGGLE  ‘»≈Œ            DROP ;                                                                           ‹ : EMPTYBUF  ( BUFADDR --)                 2+ DUP ON 4+ OFF ;                                                             ‹ : READBLK                                 ( BLK FILE ADDR -- BLK FILE ADDR)      DUP EMPTYBUF  INPUT PUSH  OUTPUT PUSH    STANDARDI/O   >R                         ¬≈«…Œ OVER OFFSET @ + OVER                     R@ 8 +  -ROT   1  R/W              ◊»…Ã≈ ." READ " DISKERR                  “≈–≈¡‘  R>  ;                                                                   ( TAKE MARK UPDATES? FULL? CORE?     BP)                                          ‹ : TAKE   ( -- BUFADDR)    PREV          ¬≈«…Œ  DUP @  ◊»…Ã≈  @  DUP 2+ @ -1 =    ’Œ‘…Ã                                    BUFFERS LOCK   DUP BACKUP ;                                                      ‹ : MARK                                  ( BLK FILE BUFADDR -- BLK FILE )         2+ >R 2DUP R@ !  OFFSET @ +  R@ 2+ !     R> 4+ OFF  BUFFERS UNLOCK ;                                                      ‹ : UPDATES?  ( -- BUFADDR / FLAG)        PREV  ¬≈«…Œ  @ DUP  ◊»…Ã≈  DUP 6+ @        0<  ’Œ‘…Ã ;                                                                    ‹ : FULL?   ( -- FLAG)                    PREV ¬≈«…Œ @ DUP @ 0= ’Œ‘…Ã  6+ @ 0< ;                                           : CORE?  ( BLK FILE -- ADDR /FALSE)       (CORE? 2DROP FALSE ;                                                                                                                                                                                       ( BLOCK & BUFFER MANIPULATION 11JUN85BP)                                          : (BUFFER ( BLK FILE -- ADDR)             ¬≈«…Œ  (CORE? TAKE MARK                  “≈–≈¡‘ ;                                                                         : (BLOCK  ( BLK FILE -- ADDR)             ¬≈«…Œ  (CORE? TAKE READBLK MARK          “≈–≈¡‘ ;                                                                         ‹ √ODE FILE@  ( -- N )                    USER' FILE # LDY                         ’– )Ÿ LDA  PHA  INY  ’– )Ÿ LDA           –USH JMP  END-CODE                                                               : BUFFER  ( BLK -- ADDR )                 FILE@  (BUFFER ;                                                                 : BLOCK   ( BLK -- ADDR )                 FILE@  (BLOCK ;                                                                                                                                                                                                                                     ( BLOCK & BUFFER MANIPULATION 09SEP84KS)                                          : UPDATE   080 PREV @  6+ 1+ C! ;                                                 : SAVE-BUFFERS                            BUFFERS LOCK ¬≈«…Œ   UPDATES? ?DUP                    ◊»…Ã≈ BACKUP “≈–≈¡‘         BUFFERS UNLOCK  ;                                                                : EMPTY-BUFFERS                           BUFFERS LOCK  PREV                       ¬≈«…Œ @ ?DUP                             ◊»…Ã≈ DUP EMPTYBUF                       “≈–≈¡‘  BUFFERS UNLOCK ;                                                         : FLUSH    SAVE-BUFFERS EMPTY-BUFFERS ;                                                                                                                                                                                                                                                                                                                                                                                  ( MOVING BLOCKS               15DEC83KS)                                          ‹ : (COPY   ( FROM TO --)                 DUP FILE@                                CORE? …∆ PREV @ EMPTYBUF ‘»≈Œ            FULL? …∆  SAVE-BUFFERS   ‘»≈Œ            OFFSET @ + SWAP BLOCK 2- 2- !  UPDATE ;                                          ‹ : BLKMOVE  ( FROM TO QUAN --)           SAVE-BUFFERS >R                          OVER R@ + OVER U> >R  2DUP U< R> AND      …∆  R@ R@ D+  R> 0 ?ƒœ -1 -2 D+                                 2DUP (COPY Ãœœ–   ≈Ã”≈          R> 0 ?ƒœ 2DUP (COPY 1                                 1 D+   Ãœœ–   ‘»≈Œ  SAVE-BUFFERS 2DROP ;                                                      : COPY    ( FROM TO --)   1 BLKMOVE ;                                             : CONVEY  ( [BLK1 BLK2] [TO.BLK --)       SWAP  1+  2 PICK -   DUP 0> NOT          ¡BORT" NEIN"  BLKMOVE ;                                                                                                                                           \ ¡LLOCATING BUFFERS          CLV12JUL87                                          ≈400 √ONSTANT LIMIT     ÷ARIABLE FIRST                                            : ALLOTBUFFER   ( -- )                    FIRST @  R0 @ -  B/BUF 2+ U< ?EXIT       B/BUF NEGATE FIRST +!                    FIRST @ DUP EMPTYBUF                     PREV  @ OVER !  PREV !   ;                                                       : FREEBUFFER    ( -- )                    FIRST @   LIMIT B/BUF - U<                …∆ FIRST @ BACKUP PREV                     ¬≈«…Œ  DUP @ FIRST @  -                  ◊»…Ã≈  @  “≈–≈¡‘                       FIRST @  @ SWAP ! B/BUF FIRST +!         ‘»≈Œ ;                                                                          : ALL-BUFFERS                             ¬≈«…Œ  FIRST @ ALLOTBUFFER                      FIRST @  = ’Œ‘…Ã ;                                                                                                                                                                                  ( ENDPOINTS OF FORGET      04JAN85BP/KS)                                          ‹ : ‹? ( NFA -- FLAG )   C@  020  AND ;                                           ‹ : FORGET?  ( ADR NFA -- FLAG )              \ CODE IN HEAP OR ABOVE ADR ?        NAME> UNDER 1+ U< SWAP  HEAP?  OR ;                                              ‹  : ENDPOINTS  ( ADDR -- ADDR SYMB)      HEAP   VOC-LINK @ >R                     ¬≈«…Œ R> @ ?DUP    \ THROUGH ALL ÷OCABS  ◊»…Ã≈ DUP >R 4 - >R \ LINK ON RETURNST.   ¬≈«…Œ R> @ >R OVER 1- DUP R@  U<                           \ UNTIL LINK  OR                  SWAP  R@ 2+ NAME> U< AND                        \ CODE UNDER ADR       ◊»…Ã≈  R@ HEAP?  [ 2DUP ] ’Œ‘…Ã                     \ SEARCH FOR A NAME IN HEAP     R@ 2+ ‹?  …∆  OVER R@ 2+ FORGET?                    …∆ R@ 2+ (NAME> 2+ UMAX                  ‘»≈Œ \ THEN UPDATE SYMB                 ‘»≈Œ                         “≈–≈¡‘ RDROP                            “≈–≈¡‘  ;                                                                       \ REMOVE                       23JUL85WE                                          ‹ √ODE REMOVE ( DIC SYMB THR - DIC SYMB)  5 # LDY [[ ”– )Ÿ LDA Œ ,Ÿ STA DEY 0< ?]  USER' S0 # LDY                           CLC ’– )Ÿ LDA 6 # ADC Œ 6 + STA          INY ’– )Ÿ LDA 0 # ADC Œ 7 + STA          1 # LDY                                  [[ Œ ÿ) LDA Œ 8 + STA                       Œ )Ÿ LDA Œ 9 + STA Œ 8 + ORA  0<>     ?[[ Œ 8 + LDA Œ 6 + CMP                      Œ 9 + LDA Œ 7 + SBC √”                 ?[ Œ 8 + LDA Œ 2 + CMP                      Œ 9 + LDA Œ 3 + SBC                   ][ Œ 4 + LDA Œ 8 + CMP                      Œ 5 + LDA Œ 9 + SBC                   ]? √√                                    ?[ Œ 8 + ÿ) LDA Œ ÿ) STA                    Œ 8 + )Ÿ LDA Œ )Ÿ STA                 ][ Œ 8 + LDA    Œ    STA                    Œ 9 + LDA Œ 1+ STA ]?               ]]? (DROP JMP   END-CODE                                                                                                                                          ( REMOVE-     FORGET-WORDS    29APR85BP)                                          ‹ : REMOVE-WORDS ( DIC SYMB -- DIC SYMB)  VOC-LINK  ¬≈«…Œ  @ ?DUP                   ◊»…Ã≈  DUP >R 4 - REMOVE R>  “≈–≈¡‘  ;                                          ‹ : REMOVE-TASKS  ( DIC --)               UP@  ¬≈«…Œ  1+ DUP @ UP@ -               ◊»…Ã≈  2DUP @ SWAP HERE UWITHIN           …∆ DUP @ 1+ @ OVER ! 1-  ≈Ã”≈  @ ‘»≈Œ   “≈–≈¡‘  2DROP ;                                                                  ‹ : REMOVE-VOCS  ( DIC SYMB -- DIC SYMB)  VOC-LINK REMOVE THRU.VOCSTACK             ƒœ  2DUP … @  -ROT  UWITHIN                …∆   [ ' ∆ORTH 2+ ] ÃITERAL … ! ‘»≈Œ   -2 +Ãœœ–                                2DUP   CURRENT @  -ROT   UWITHIN          …∆ [ ' ∆ORTH 2+ ] ÃITERAL CURRENT !      ‘»≈Œ ;                                                                          ƒEFER CUSTOM-REMOVE                      ' NOOP …S CUSTOM-REMOVE                                                                                                   ( DELETING WORDS FROM DICT.   13JAN83KS)                                          ‹ : FORGET-WORDS    ( DIC SYMB --)        OVER REMOVE-TASKS REMOVE-VOCS                 REMOVE-WORDS CUSTOM-REMOVE          HEAP SWAP - HALLOT DP !  0 LAST ! ;                                              : CLEAR                                   HERE  DUP UP@ FORGET-WORDS   DP ! ;                                              : (FORGET ( ADR --)                       DUP  HEAP? ¡BORT" IS SYMBOL"             ENDPOINTS FORGET-WORDS ;                                                         : FORGET  ' DUP [ DP ] ÃITERAL @          U<  ¡BORT" PROTECTED"                    >NAME DUP HEAP?                          …∆  NAME>  ≈Ã”≈  2- 2-  ‘»≈Œ             (FORGET   ;                                                                      : EMPTY  [ DP ] ÃITERAL @                 UP@ FORGET-WORDS                         [ UDP ] ÃITERAL @  UDP ! ;                                                                                               \ SAVE BYE STOP? ?CR         CLV2:JULL87                                          : SAVE                                    HERE UP@ FORGET-WORDS                    VOC-LINK @  ¬≈«…Œ  DUP 2- 2-  @  OVER                  2- !  @ ?DUP 0=  ’Œ‘…Ã     UP@ ORIGIN $100 CMOVE   ;                                                        : BYE SAVE-BUFFERS (BYE ;                \ : BYE       FLUSH EMPTY (BYE ;                                                  ‹ : END?    KEY ( #CR ) (√ 3 ) =                     …∆ TRUE RDROP ‘»≈Œ ;                                                  : STOP?   ( -- FLAG)                      KEY? …∆ END? END? ‘»≈Œ FALSE ;                                                   : ?CR   COL  C/L $¡ -  U> …∆ CR ‘»≈Œ ;                                                                                                                                                                                                                                                                                                 ( IN/OUTPUT STRUCTURE         02MAR85BP)                                          ‹ : œUT:  √REATE DUP C,  2+                        ƒOES> C@ OUTPUT @ +  PERFORM ;                                            : œUTPUT:  √REATE:                                  ƒOES>  OUTPUT ! ;                                                    0  œUT: EMIT   œUT: CR     œUT: TYPE        œUT: DEL    œUT: PAGE   œUT: AT          œUT: AT?                              DROP                                                                              : ROW   ( -- ROW)  AT? DROP ;            : COL   ( -- COL)  AT? NIP ;                                                      ‹ : …N:    √REATE DUP C, 2+                         ƒOES> C@ INPUT @ + PERFORM ;                                             : …NPUT:  √REATE:                                  ƒOES> INPUT ! ;                                                       0  …N: KEY   …N: KEY?   …N: DECODE          …N: EXPECT                            DROP                                    ( ¡LIAS  ONLY DEFINITIONEN    29JAN85BP)                                          œNLY DEFINITIONS ∆ORTH                                                            : SEAL  0 ['] œNLY  >BODY  ! ;                   \ KILL ALL WORDS IN œNLY)                                                       ' œNLY  ¡LIAS œNLY                       ' ∆ORTH ¡LIAS ∆ORTH                      ' WORDS ¡LIAS WORDS                      ' ALSO  ¡LIAS ALSO                 ' DEFINITIONS ¡LIAS DEFINITIONS                                                   »OST ‘ARGET                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \ 'COLD                   01OCT87CLV/RE)                                          ‹ : INIT-VOCABULARYS   VOC-LINK @         ¬≈«…Œ  DUP  2- @  OVER 4 - !                    @ ?DUP 0= ’Œ‘…Ã ;                                                         ‹ : INIT-BUFFERS                          0 PREV !  LIMIT FIRST !  ALL-BUFFERS ;                                           ƒEFER 'COLD    ' NOOP …S 'COLD                                                    ‹ : (COLD                                 INIT-VOCABULARYS  INIT-BUFFERS           œNLYFORTH 'COLD                          PAGE LOGO COUNT TYPE CR                  (RESTART ;                                                                       ƒEFER 'RESTART  ' NOOP …S 'RESTART                                                ‹ : (RESTART                              ['] (QUIT …S 'QUIT                       DRVINIT 'RESTART  [ ERRORHANDLER ]       ÃITERAL @ ERRORHANDLER !                 [']  NOOP …S 'ABORT ABORT ;                                                     \ FORTH-INIT              01OCT87CLV/RE)                                          ÃABEL FORTH-INIT                          ¬OOTNEXTLEN 1- # LDY                     [[ ¬OOTNEXT ,Ÿ LDA –UT¡ ,Ÿ STA              DEY 0< ?]                             CLC S0 LDA 6 # ADC ’– STA                 S0 1+ LDA 0 # ADC ’– 1+ STA             USER' S0 # LDY  ’– )Ÿ LDA ”– STA                    INY  ’– )Ÿ LDA ”– 1+ STA      USER' R0 # LDY  ’– )Ÿ LDA “– STA                    INY  ’– )Ÿ LDA “– 1+ STA      0 # LDX 1 # LDY TXA “– ÿ) STA “– )Ÿ STA ÃABEL DONOTHING RTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \ COLD RESTART                 06NOV87RE                                          √ODE COLD        HERE >COLD !             $∆∆ # LDX  TXS                          ÃABEL BOOTSYSTEM                          DONOTHING JSR \ PATCH FOR FIRST-INIT     CLC S0 LDA 6 # ADC Œ STA                  S0 1+ LDA 0 # ADC Œ 1+ STA  0 # LDY     [[ ORIGIN ,Ÿ LDA Œ )Ÿ STA INY 0= ?]      FORTH-INIT JSR                           ;C: INIT-SYSTEM  (COLD ;                                                         √ODE RESTART     HERE >RESTART !          $∆∆ # LDX  TXS                          ÃABEL WARMBOOT                            DONOTHING JSR \ PATCH FOR FIRST-INIT     FORTH-INIT JSR                           ;C: INIT-SYSTEM  (RESTART ;                                                      ÃABEL XYŒEXT                              0 # LDX 1 # LDY ŒEXT JMP END-CODE                                                                                                                                                                          \ ”YSTEM-ÃOADSCREEN       01OCT87CLV/RE)                                           3 $18 +THRU          \ √¬Õ-…NTERFACE    (C16+    19 +LOAD )   \ C16INIT “AM…“—                                                                                     »OST  ' ‘RANSIENT 8 + @                    ‘RANSIENT  ∆ORTH  √ONTEXT @ 6 + !      ‘ARGET     \ KOTZ WUERG !                                                         ∆ORTH ALSO DEFINITIONS                                                            (√16 : (64 ) \ SPRINGT HINTER √)         (√64 : (16 )                              ¬≈«…Œ NAME COUNT 0= ABORT" √) MISSING"   @ [ ¡SCII √ ¡SCII ) $100 * + ] ÃITERAL   = ’Œ‘…Ã ; IMMEDIATE                                                              : √)  ; IMMEDIATE                                                                 (√16 : (16 ) (√64 : (64 ) ; IMMEDIATE                                             : FORTH-83 ;  \ LAST WORD IN ƒICTIONARY                                                                                   ( ”YSTEM DEPENDENT √ONSTANTS      BP/KS)                                          ÷OCABULARY ¡SSEMBLER                     ¡SSEMBLER DEFINITIONS                    ‘RANSIENT  ¡SSEMBLER                                                              –USH¡  √ONSTANT –USH¡                           \ PUT ¡ SIGN-EXTENDED ON STACK    –USH0¡ √ONSTANT –USH0¡                          \ PUT ¡ ON STACK                  –USH   √ONSTANT –USH                            \ Õ”¬ IN ¡ AND Ã”¬ ON JSR-STACK                                            “–     √ONSTANT “–                       ’–     √ONSTANT ’–                       ”–     √ONSTANT ”–                       …–     √ONSTANT …–                       Œ      √ONSTANT Œ                        –UTA   √ONSTANT –UTA                     ◊      √ONSTANT ◊                        ”ETUP  √ONSTANT ”ETUP                    ŒEXT   √ONSTANT ŒEXT                     XYŒEXT √ONSTANT XYŒEXT                   (2DROP √ONSTANT –OPTWO                   (DROP  √ONSTANT –OP                     \ ”YSTEM PATCHUP              CLV06AUG87                                          ∆ORTH DEFINITIONS                                                                 (√64  √000 ' LIMIT >BODY !                     7¬00 S0 !  7∆00 R0 ! )                                                      (√16  8000 ' LIMIT >BODY !                     7700 S0 !  7B00 R0 ! )                                                      \ (√16+ FD00 ' LIMIT >BODY !             \       7¬00 S0 !  7∆00 R0 ! )                                                    S0 @ DUP S0 2- !      6 + S0 7 - !       HERE DP !                                                                         »OST  ‘UDP @          ‘ARGET  UDP !      »OST  ‘VOC-LINK @     ‘ARGET  VOC-LINK ! »OST  MOVE-THREADS                                                                                                                                                                                                                                                                            \ √¬Õ-ÃABELS                   05NOV87RE                                          $∆∆¡5 >LABEL ¡√–‘“                       $∆∆√6 >LABEL √»À…Œ                       $∆∆√9 >LABEL √»Àœ’‘                      $∆∆ƒ2 >LABEL √»“œ’‘                      $∆∆81 >LABEL √…Œ‘                        $∆∆¡8 >LABEL √…œ’‘                       $∆∆√3 >LABEL √Ãœ”≈                       $∆∆√√ >LABEL √Ã“√»Œ                      $∆∆≈4 >LABEL «≈‘…Œ                       $∆∆84 >LABEL …œ…Œ…‘                      $∆∆¬1 >LABEL Ã…”‘≈Œ                      $∆∆√0 >LABEL œ–≈Œ                        $∆∆∆0 >LABEL –Ãœ‘                        $∆∆8¡ >LABEL “≈”‘œ“                      $∆∆93 >LABEL ”≈√œŒƒ                      $∆∆≈1 >LABEL ”‘œ–                        $∆∆¬4 >LABEL ‘¡ÃÀ                        $∆∆96 >LABEL ‘À”¡                        $∆∆≈¡ >LABEL ’ƒ‘…Õ                       $∆∆¡≈ >LABEL ’ŒÃ”Œ                       $∆∆¡¬ >LABEL ’Œ‘ÃÀ                       $∆∆√∆ >LABEL √»“…Œ                       $∆∆99 >LABEL Õ≈Õ‘œ–                     \ √64-ÃABELS                 CLV13.4.87)                                          (√64                                                                              0≈716 >LABEL √ONœUT                        09D >LABEL ÕSG∆LG                        09A >LABEL œUTƒEV                        099 >LABEL  …NƒEV                      0D020 >LABEL ¬RD√OL                      0D021 >LABEL ¬KG√OL                       0286 >LABEL –EN√OL                        0AE >LABEL –RG≈ND                        0C1 >LABEL …œ¬EG                         0D4 >LABEL √UR∆LG                        0D8 >LABEL …NS√NT                       028A >LABEL ÀEY“EP                                                                                                                                                                                                                                   )                                                                                                                                                                  \ √16-ÃABELS                 CLV13.4.87)                                          (√16                                                                              0FF4C >LABEL √ONœUT                        09A >LABEL ÕSG∆LG                        099 >LABEL œUTƒEV                        098 >LABEL  …NƒEV                      0FF19 >LABEL ¬RD√OL                      0FF15 >LABEL ¬KG√OL                       0540 >LABEL –EN√OL                        09D >LABEL –RG≈ND                        0B2 >LABEL …œ¬EG                         0CB >LABEL √UR∆LG                        0CF >LABEL …NS√NT                       0540 >LABEL ÀEY“EP                                                                                                                                                                                           055D >LABEL –ÀEYS                       )                                                                                                                                                                  \ C64KEY? GETKEY              CLV12JUL87                                          √ODE C64KEY? ( -- FLAG)                  (√64  0√6 LDA            ( )             (C16  0EF LDA  055D ORA  ( )              0<> ?[  0∆∆ # LDA  ]? PHA                –USH JMP  END-CODE                                                               √ODE GETKEY  ( -- 8B)                    (√64 0√6 LDA  0<>                         ?[  SEI  0277 LDY                         [[  0277 1+ ,ÿ LDA  0277 ,ÿ STA  INX         0√6 CPX  0= ?]                       0√6 DEC  TYA  CLI  0¡0 # CMP             0= ?[  BL # LDA  ]?                     ]? ( )                                  (√16 0EBDD JSR                             0¡0 # CMP 0= ?[  BL # LDA  ]? ( )       –USH0¡ JMP   END-CODE                                                                                                                                                                                                                                                                        ( CURON CUROFF               CLV12.4.87)                                          (√16  √ODE CURON \ --                    0CA LDA CLC 0C8 ADC 0FF0D STA            0C9 LDA     0 # ADC 0B # SBC 0FF0C STA   NEXT JMP END-CODE                                                                 √ODE CUROFF \ --                         0FF # LDA FF0C STA 0FF0D STA ŒEXT JMP    END-CODE )                                                                        (√16 \\ )                                                                         √ODE CURON   ( --)                        0ƒ3 LDY  0ƒ1 )Ÿ LDA  0√≈ STA  0√√ STX    XYŒEXT JMP   END-CODE                                                            √ODE CUROFF   ( --)                       INY  0√√ STY  0√ƒ STY  0√∆ STX           0√≈ LDA  0ƒ3 LDY  0ƒ1 )Ÿ STA             1 # LDY  ŒEXT JMP   END-CODE                                                                                                                                                                               ( #BS #CR ..KEYBOARD         CLV12.4.87)                                                                                   : C64KEY  ( -- 8B)                        CURON ¬≈«…Œ PAUSE C64KEY?  ’Œ‘…Ã         CUROFF GETKEY ;                                                                  14 √ONSTANT #BS   0ƒ √ONSTANT #CR                                                 : C64DECODE                               ( ADDR CNT1 KEY -- ADDR CNT2)             #BS CASE?  …∆  DUP  …∆ DEL 1- ‘»≈Œ                                 EXIT  ‘»≈Œ     #CR CASE?  …∆  DUP SPAN ! EXIT ‘»≈Œ      >R  2DUP +  R@ SWAP C!  R> EMIT  1+ ;                                           : C64EXPECT ( ADDR LEN1 -- )              SPAN !  0                                ¬≈«…Œ  DUP SPAN @  U<                    ◊»…Ã≈  KEY  DECODE                       “≈–≈¡‘ 2DROP SPACE ;                                                             …NPUT: KEYBOARD   [ HERE INPUT ! ]        C64KEY C64KEY? C64DECODE C64EXPECT ;                                            ( CON! PRINTABLE?            CLV11.4.87)                                          √ODE CON!  ( 8B --)   ”– ÿ) LDA          ÃABEL (CON!     √ONœUT JSR    ”– 2INC    ÃABEL (CON!END  √UR∆LG STX …NS√NT STX     1 # LDY ;C:  PAUSE ;                                                             ÃABEL (PRINTABLE?   \ FUER √¬Õ-√ODE !                        \ √” IS PRINTABLE      80 # CMP  √√ ?[   BL # CMP  RTS  ]?     0≈0 # CMP  √√ ?[  0√0 # CMP  RTS  ]?     CLC  RTS  END-CODE                                                               √ODE PRINTABLE? ( 8B -- 8B FLAG)          ”– ÿ) LDA  (PRINTABLE? JSR √” ?[ DEX ]?  TXA  –USH¡ JMP     END-CODE                                                                                                                                                                                                                                                                                                                                                                                             ( EMIT CR DEL PAGE AT AT?    CLV11.4.87)                                          √ODE C64EMIT  ( 8B -- )                   ”– ÿ) LDA  (PRINTABLE? JSR                  √√ ?[  ¡SCII . # LDA ]?               (CON! JMP   END-CODE                                                             : C64CR     #CR CON! ;                                                            : C64DEL    9ƒ CON!  SPACE  9ƒ CON! ;                                             : C64PAGE   93 CON! ;                                                             √ODE C64AT  ( ROW COL --)                 2 # LDA  ”ETUP JSR                       Œ 2+ LDX  Œ LDY  CLC  –Ãœ‘ JSR          (√16 \ ) 0ƒ3 LDY  0ƒ1 )Ÿ LDA   0√≈ STA    XYŒEXT JMP  END-CODE                                                             √ODE C64AT?  ( -- ROW COL)                ”– 2DEC TXA  ”– )Ÿ STA                   SEC  –Ãœ‘ JSR                            28 # CPY  TYA  √” ?[ 28 # SBC ]?         PHA  TXA  0 # LDX  ”– ÿ) STA  PLA        –USH0¡ JMP  END-CODE                   ( TYPE DISPLAY (BYE          CLV11.4.87)                                          √ODE  C64TYPE  ( ADR LEN -- )             2 # LDA  ”ETUP JSR  0 # LDY               [[  Œ CPY  0<>                           ?[[  Œ 2+ )Ÿ LDA  (PRINTABLE? JSR               √√ ?[  ¡SCII . # LDA  ]?         √ONœUT JSR  INY  ]]?                     (CON!END JMP   END-CODE                                                          œUTPUT: DISPLAY   [ HERE OUTPUT ! ]       C64EMIT C64CR C64TYPE C64DEL C64PAGE     C64AT C64AT? ;                                                                   (√64  ‹ √REATE (BYE  $∆√≈2  HERE 2- ! )                                           (√16- ‹ √REATE (BYE  $∆∆52  HERE 2- ! )                                           (√16+ ‹ √œƒ≈   (BYE  ROM $∆∆52 JMP                                    END-CODE )                                                                                                                                                                                                              \ B/BLK DRIVE >DRIVE DRVINIT  CLV14:2X87                                          400 √ONSTANT B/BLK                                                                0¡¡ √ONSTANT BLK/DRV                                                              ÷ARIABLE (DRV    0 (DRV !                                                         ‹ : DISK ( -- DEV.NO )   (DRV @ 8 + ;                                             : DRIVE  ( DRV# -- )                      BLK/DRV *  OFFSET ! ;                                                            : >DRIVE ( BLOCK DRV# -- BLOCK' )         BLK/DRV * +   OFFSET @ - ;                                                       : DRV?    ( BLOCK -- DRV# )               OFFSET @ + BLK/DRV / ;                                                           : DRVINIT  NOOP ;                                                                                                                                                                                                                                    ( I/O BUSOFF                  10MAY85WE)                                          ÷ARIABLE I/O  0 I/O !  \ ”EMAPHOR                                                 √ODE BUSOFF  ( --)   √Ã“√»Œ JSR          ÃABEL UNLOCKI/O  1 # LDY  0 # LDX         ;C:  I/O UNLOCK ;                                                                ÃABEL NODEVICE     0 # LDX  1 # LDY       ;C:  BUSOFF   BUFFERS UNLOCK                  TRUE ¡BORT" NO DEVICE" ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \ ?DEVICE                     CLV12JUL87                                          ÃABEL (?DEV                               90 STX (√16 $AE STA ( ) Ã…”‘≈Œ JSR              \ WG. ∆EHLER IM ¬ETR.SYST.        60 # LDA  ”≈√œŒƒ JSR  ’ŒÃ”Œ JSR          90 LDA  0<> ?[ PLA PLA NODEVICE JMP ]?   RTS    END-CODE                                                                  ‹ √ODE (?DEVICE  ( DEV --)                ”– ÿ) LDA  (?DEV JSR  ”– 2INC            UNLOCKI/O JMP  END-CODE                                                          : ?DEVICE  ( DEV -- )                     I/O LOCK  (?DEVICE ;                                                             ‹ √ODE (BUSOUT  ( DEV 2ND -- )            ÕSG∆LG STX  2 # LDA  ”ETUP JSR           Œ 2+ LDA  (?DEV JSR                      Œ 2+ LDA  Ã…”‘≈Œ JSR                     Œ LDA  60 # ORA ”≈√œŒƒ JSR               Œ 2+ LDX  œUTƒEV STX                     XYŒEXT JMP  END-CODE                                                                                                     \ BUSOUT/OPEN/CLOSE/IN        CLV12JUL87                                          : BUSOUT    ( DEV 2ND -- )                I/O LOCK (BUSOUT ;                                                               : BUSOPEN   ( DEV 2ND -- )                0∆0 OR BUSOUT ;                                                                  : BUSCLOSE  ( DEV 2ND -- )                0≈0 OR BUSOUT BUSOFF ;                                                           ‹ √ODE (BUSIN  ( DEV 2ND -- )             ÕSG∆LG STX  2 # LDA  ”ETUP JSR           Œ 2+ LDA  (?DEV JSR                      Œ 2+ LDA  ‘¡ÃÀ JSR                       Œ LDA  60 # ORA (√16 $AD STA ( )         ‘À”¡ JSR                                \ WG. ∆EHLER IM √16¬ETR.SYS-ALTE ÷ERS.    Œ 2+ LDX  …NƒEV STX                      XYŒEXT JMP END-CODE                                                              : BUSIN  ( DEV 2ND -- )                   I/O LOCK  (BUSIN ;                                                                                                       ( BUS-!/TYPE/@/INPUT DERROR?  24FEB85RE)                                          √ODE BUS!  ( 8B --)                       ”– ÿ) LDA  √…œ’‘ JSR  (XYDROP JMP        END-CODE                                                                         : BUSTYPE  ( ADR N --)                    BOUNDS  ?ƒœ  … C@ BUS!  Ãœœ– PAUSE ;                                             √ODE BUS@  ( -- 8B)                       ¡√–‘“ JSR –USH0¡ JMP  END-CODE                                                   : BUSINPUT  ( ADR N --)                   BOUNDS  ?ƒœ  BUS@ … C! Ãœœ– PAUSE ;                                              : DERROR?  ( -- FLAG )                    DISK $∆ BUSIN BUS@  DUP ¡SCII 0 -         …∆  ¬≈«…Œ EMIT BUS@ DUP #CR =  ’Œ‘…Ã     0= CR  ‘»≈Œ   0=  BUSOFF ;                                                                                                                                                                                                                                                                  ( S#>S+T  X,X                 28MAY85RE)                                          165 ‹ √ONSTANT 1.T                       1≈¡ ‹ √ONSTANT 2.T                       256 ‹ √ONSTANT 3.T                                                                ‹ : (S#>S+T ( SECTOR# -- SECT TRACK)           DUP 1.T U< …∆ 15 /MOD EXIT ‘»≈Œ     3 +  DUP 2.T U< …∆ 1.T - 13 /MOD 11 +                               EXIT ‘»≈Œ          DUP 3.T U< …∆ 2.T - 12 /MOD 18 +                               EXIT ‘»≈Œ     3.T - 11 /MOD 1≈ + ;                                                             ‹ : S#>T+S  ( SECTOR# -- TRACK SECT )     (S#>S+T  1+ SWAP ;                                                               ‹ : X,X ( SECT TRACK -- ADR COUNT)        BASE PUSH  DECIMAL                       0 <# #S DROP ¡SCII , HOLD #S #> ;                                                                                                                                                                                                                   ( READSECTOR WRITESECTOR      28MAY85RE)                                          100 ‹ √ONSTANT B/SEK                                                              : READSECTOR  ( ADR TRA# SECT# -- FLAG)   DISK 0∆ BUSOUT                           " U1:13,0," COUNT   BUSTYPE              X,X BUSTYPE BUSOFF PAUSE                 DERROR? ?EXIT                            DISK 0ƒ BUSIN B/SEK BUSINPUT BUSOFF      FALSE ;                                                                          : WRITESECTOR  ( ADR TRA# SECT# -- FLAG)  ROT DISK 0∆ BUSOUT                       " B-P:13,0" COUNT BUSTYPE BUSOFF         DISK 0ƒ BUSOUT B/SEK BUSTYPE BUSOFF      DISK 0∆ BUSOUT                           " U2:13,0," COUNT  BUSTYPE               X,X BUSTYPE BUSOFF PAUSE  DERROR? ;                                                                                                                                                                                                                                                          ( 1541R/W                     28MAY85RE)                                          : DISKOPEN  ( -- FLAG)                    DISK 0ƒ BUSOPEN  ¡SCII # BUS! BUSOFF     DERROR? ;                                                                        : DISKCLOSE ( -- )                        DISK 0ƒ BUSCLOSE  BUSOFF ;                                                       : 1541R/W  ( ADR BLK FILE R/WF -- FLAG)   SWAP ¡BORT" NO FILE"                     -ROT  BLK/DRV /MOD  DUP (DRV ! 3 U>      …∆ . ." BEYOND CAPACITY" NIP EXIT  ‘»≈Œ  DISKOPEN  …∆  DROP NIP EXIT  ‘»≈Œ        0 SWAP   2* 2* 4 BOUNDS                  ƒœ  DROP  2DUP … ROT                         …∆    S#>T+S READSECTOR                  ≈Ã”≈  S#>T+S WRITESECTOR ‘»≈Œ            >R B/SEK + R> DUP  …∆  Ã≈¡÷≈  ‘»≈Œ   Ãœœ–   -ROT  2DROP  DISKCLOSE  ;                                                 ' 1541R/W  …S   R/W                                                                                                                                                \ INDEX FINDEX INK-POT         05NOV87RE                                          : INDEX ( FROM TO --)                     1+ SWAP ƒœ                                 CR  … 2 .R  … BLOCK 1+  25  TYPE         STOP?  …∆ Ã≈¡÷≈ ‘»≈Œ  Ãœœ– ;                                                   : FINDEX ( FROM TO --)                    DISKOPEN  …∆  2DROP  EXIT  ‘»≈Œ          1+ SWAP ƒœ  CR  … 2 .R                     PAD DUP … 2* 2* S#>T+S READSECTOR        >R 1+ 25 TYPE                            R> STOP? OR …∆ Ã≈¡÷≈ ‘»≈Œ              Ãœœ–  DISKCLOSE  ;                                                               √REATE INK-POT                               \ BORDER BKGND PEN  0                (√64  6 C,   6 C,  3 C, 0 C,   \ ∆ORTH        0≈ C,   6 C,  3 C, 0 C,   \ ≈DI           6 C,   6 C,  3 C, 0 C, ) \ ’SER    (√16 F6 C, 0F6 C, 03 C, 0 C,   \ ∆ORTH       0E≈ C, 0F6 C, 03 C, 0 C,   \ ≈DI         0F6 C, 0F6 C, 03 C, 0 C, ) \ ’SER                                                                                     \ RESTORE                      05NOV87RE                                          (√16 \\ )                                                                         ÃABEL ASAVE 0 C,    ÃABEL 1SAVE 0 C,                                              ÃABEL CONTINUE                            PHA  1SAVE LDA  1 STA  PLA  RTI                                                  ÃABEL RESTORE   SEI  ASAVE STA            CONTINUE $100 /MOD                       # LDA PHA  # LDA PHA  PHP  \ FOR “‘…     ASAVE LDA PHA  TXA PHA  TYA PHA          1 LDA 1SAVE STA                          $36 # LDA   1 STA  \ ¬ASIC OFF “œÕ ON    $7∆ # LDA  $ƒƒ0ƒ STA                     $ƒƒ0ƒ LDY  0< ?[                        ÃABEL 6526-ŒÕ… $∆≈72 JMP  ]?              ’ƒ‘…Õ JSR ”‘œ– JSR  \ “’Œ/”‘œ– ?         6526-ŒÕ… BNE        \ NOT >>-->          ' RESTART @ JMP  END-CODE                                                                                                                                                                                  \ √64:…NITIALISIERUNG          06NOV87RE (√16 \\ )                                                                         : INIT-SYSTEM   $∆∆40 DUP $√0 CMOVE       [ RESTORE ] ÃITERAL  DUP                 $∆∆∆¡ ! $318 ! ;  \ ŒÕ…-÷ECTOR INS “¡Õ                                           ÃABEL FIRST-INIT                          SEI CLD                                  …œ…Œ…‘ JSR  √…Œ‘ JSR  “≈”‘œ“ JSR          \ INIT. AND SET …/œ-÷ECTORS             $36 # LDA   01 STA        \ ¬ASIC OFF    INK-POT    LDA ¬RD√OL STA \ BORDER       INK-POT 1+ LDA ¬KG√OL STA \ BACKGRND     INK-POT 2+ LDA –EN√OL STA \ PEN         $80 # LDA ÀEY“EP STA  \ REPEAT ALL KEYS  $17 # LDA  $ƒ018 STA  \ LOW/UPP +          0 # LDA  $ƒ01¡ STA  \ ÷…√-…“— OFF      $1¬ # LDA  $ƒ011 STA  \ ‘EXTMODE ON        4 # LDA   $288 STA  \ LOW SCREEN        CLI RTS END-CODE                        FIRST-INIT DUP BOOTSYSTEM 1+ !                          WARMBOOT   1+ !           √ODE C64INIT FIRST-INIT JSR               XYŒEXT JMP END-CODE                    \ √16:…NITIALISIERUNG..   01OCT87CLV/RE)                                          (√64 \\ )                                                                         √ODE INIT-SYSTEM $∆7 # LDX  TXS           XYŒEXT JMP END-CODE                                                              $FCB3 >LABEL …“—   \ NORMALER …NTERRUPT  $FFFE >LABEL >…“—  \ 6502-–TR AUF …NT.                                            \ SELBSTMODIFIZIEREND:                   ÃABEL “¡Õ…“—       \ DER NEUE …NTERRUPT     ROM “¡Õ…“— $15 + STA “¡Õ…“— $17 + STX (  +9) “¡Õ…“— $1B + $100 U/MOD # LDA PHA                                # LDA PHA (  +F) TSX $103 ,X LDA PHA   \ FLAGS     ( +14) 0 # LDA 0 # LDX …“— JMP           ( +1B) RAM RTI END-CODE                                                                                                                                                                                                                                                                                                                \ √16:..…NITIALISIERUNG   01OCT87CLV/RE)                                          (√64 \\ )                                                                         ÃABEL FIRST-INIT                            \ WIRD BEIM ERSTEN ÕAL                   \ AUS “œÕ,SPAETER AUS “¡Õ AUFGERUFEN   SEI ROM                                  “¡Õ…“— $100 U/MOD    \ NEUEN …“—           # LDA >…“— 1+ STA  \ .. INSTALLIEREN     # LDA >…“— STA                         $∆∆84 NORM SR  $∆∆8¡ NORM SR                \ √…¡S INIT. AND SET …/œ-÷ECTORS      INK-POT    LDA ¬RD√OL STA \ BORDER       INK-POT 1+ LDA ¬KG√OL STA \ BACKGRND     INK-POT 2+ LDA –EN√OL STA \ PEN          $80 # LDA ÀEY“EP STA \ REPEAT ALL KEYS   $∆∆13 LDA 04 # ORA $∆∆13 STA \ LOW/UPP   RAM CLI RTS END-CODE                                                             FIRST-INIT DUP BOOTSYSTEM 1+ !                          WARMBOOT   1+ !                                                    √ODE C64INIT FIRST-INIT JSR               XYŒEXT JMP END-CODE                    \ √16-–USHKEYS √64-LIKE   01OCT87CLV/RE)                                                                                   (√16                                                                              ÃABEL …NIT–ÀS \ –USHKEYS: ƒATEN          00 C, 00 C,  \ AKT. ⁄EICHENZAHL, AKT–TR. 01 C, 01 C, 01 C, 01 C, \ ”TRÃAENGEN     01 C, 01 C, 01 C, 01 C, \   "                                                     85 C, 86 C, 87 C, 89 C, \ …NHALT         8A C, 8B C, 8C C, 88 C, \   "                                                                                              HERE …NIT–ÀS - >LABEL …NIT–ÀLEN                                                                                            √ODE √64FKEYS \ –USHKEYS A LA √64          …NIT–ÀLEN # LDX                          [[ DEX  0>= ?[[                            …NIT–ÀS ,ÿ LDA –ÀEYS ,X STA ]]?        XYŒEXT JMP END-CODE                                                             )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( RESTART PARAM.-PASSING     CLV12.4.87)                                          √ODE RESTART       HERE >RESTART !        ' (RESTART >BODY 100 U/MOD               # LDA  PHA  # LDA PHA                    WARMBOOT JMP   END-CODE                                                          \ √ODE FOR PARAMETER-PASSING TO ∆ORTH                                                                                            03 18 +THRU     \ √¬Õ-…NTERFACE    (C16+ 19 1A +THRU )   \ C16INIT “AM…“—                                            »OST  ' ‘RANSIENT 8 + @                    ‘RANSIENT  ∆ORTH  √ONTEXT @ 6 + !      ‘ARGET     \ KOTZ WUERG !                                                         ∆ORTH ALSO DEFINITIONS                            : )     ; IMMEDIATE             (√64     : (√64  ; IMMEDIATE )           (√16     : (√16  ; IMMEDIATE )           (√64 \ ) : (√64  [COMPILE] ( ; IMMEDIATE (√16 \ ) : (√16  [COMPILE] ( ; IMMEDIATE : FORTH-83 ;  \ LAST WORD IN ƒICTIONARY                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          